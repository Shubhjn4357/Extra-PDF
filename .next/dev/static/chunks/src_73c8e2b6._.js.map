{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/utils/polyfill.js"],"sourcesContent":["\r\n\r\n// console.log(\"POLYFILL RUNNING\");\r\n// if (typeof window === 'undefined') {\r\n//     global.Buffer = global.Buffer || require('buffer').Buffer;\r\n//     global.DOMMatrix = global.DOMMatrix || class DOMMatrix {\r\n//         constructor() { this.a = 1; this.b = 0; this.c = 0; this.d = 1; this.e = 0; this.f = 0; }\r\n//     };\r\n//     global.Image = global.Image || class Image { };\r\n//     global.HTMLCanvasElement = global.HTMLCanvasElement || class HTMLCanvasElement { };\r\n//     global.ImageData = global.ImageData || class ImageData { };\r\n//     global.performance = global.performance || require('perf_hooks').performance;\r\n// } else if (!window.Buffer) {\r\n//     window.Buffer = require('buffer').Buffer;\r\n// }\r\n"],"names":[],"mappings":"AAEA,mCAAmC;AACnC,uCAAuC;AACvC,iEAAiE;AACjE,+DAA+D;AAC/D,oGAAoG;AACpG,SAAS;AACT,sDAAsD;AACtD,0FAA0F;AAC1F,kEAAkE;AAClE,oFAAoF;AACpF,+BAA+B;AAC/B,gDAAgD;AAChD,IAAI"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/tools/convertTools.ts"],"sourcesContent":["import { Document, Packer, Paragraph, TextRun } from 'docx';\r\nimport { PDFDocument, rgb } from 'pdf-lib';\r\n// @ts-ignore\r\nimport * as XLSX from 'xlsx';\r\n\r\n// @ts-ignore\r\nimport Tesseract from 'tesseract.js';\r\n// @ts-ignore\r\nimport mammoth from 'mammoth';\r\n// @ts-ignore\r\nimport html2canvas from 'html2canvas';\r\n// @ts-ignore\r\nimport { jsPDF } from 'jspdf';\r\n\r\n// Worker initialized in components\r\n\r\n\r\n// --- PDF TO OFFICE ---\r\n\r\nexport const createDocxFromText = async (text: string): Promise<Blob> => {\r\n    const doc = new Document({\r\n        sections: [{\r\n            children: text.split('\\n').map(line =>\r\n                new Paragraph({ children: [new TextRun(line)], spacing: { after: 200 } })\r\n            ),\r\n        }],\r\n    });\r\n    return await Packer.toBlob(doc);\r\n};\r\n\r\nexport const createXlsxFromPdf = async (file: File): Promise<Blob> => {\r\n    const { pdfjs } = await import('react-pdf');\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n    const allData: string[][] = [];\r\n\r\n    for (let i = 1; i <= pdf.numPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n        const pageText = textContent.items.map((item: any) => item.str).join(' ');\r\n\r\n        // Simple heuristic: Try to split by common CSV delimiters or double spaces if structure is simple\r\n        // For complex PDF tables, this is a best-effort client-side extraction.\r\n        const rows = pageText.split('\\n');\r\n        rows.forEach(r => {\r\n            allData.push(r.split(/\\s{2,}/)); // Split by 2+ spaces\r\n        });\r\n    }\r\n\r\n    const ws = XLSX.utils.aoa_to_sheet(allData);\r\n    const wb = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(wb, ws, \"Sheet1\");\r\n    const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\r\n    return new Blob([wbout], { type: 'application/octet-stream' });\r\n};\r\n\r\nexport const createPptxFromPdf = async (file: File): Promise<Blob> => {\r\n    // @ts-ignore\r\n    const PptxGenJSModule = await import('pptxgenjs');\r\n    const PptxGenJS = PptxGenJSModule.default || PptxGenJSModule;\r\n    const pres = new PptxGenJS();\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const { pdfjs } = await import('react-pdf');\r\n    const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n\r\n    for (let i = 1; i <= pdf.numPages; i++) {\r\n        const slide = pres.addSlide();\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n\r\n        // Add extracted text to slide\r\n        const str = textContent.items.map((item: any) => item.str).join(' ');\r\n        // Truncate to avoid overflow for demo\r\n        slide.addText(str.substring(0, 1000), { x: 0.5, y: 0.5, w: '90%', h: '80%', fontSize: 12 });\r\n        slide.addText(`Page ${i}`, { x: 0.5, y: '90%', fontSize: 10, color: '808080' });\r\n    }\r\n\r\n    return (await pres.write({ outputType: 'blob' })) as Blob;\r\n};\r\n\r\n// --- OFFICE TO PDF (Client Side Simulation/Best Effort) ---\r\n\r\nexport const wordToPdf = async (file: File): Promise<Uint8Array> => {\r\n    // Uses mammoth to extract raw text from .docx and put it in a PDF\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const result = await mammoth.extractRawText({ arrayBuffer });\r\n    const text = result.value;\r\n\r\n    // Create simple PDF from text\r\n    const pdfDoc = await PDFDocument.create();\r\n    let page = pdfDoc.addPage();\r\n    const { width, height } = page.getSize();\r\n    const fontSize = 12;\r\n\r\n    // Simple text wrapping logic\r\n    const lines = text.split('\\n');\r\n    let y = height - 50;\r\n\r\n    for (const line of lines) {\r\n        if (y < 50) { page = pdfDoc.addPage(); y = height - 50; }\r\n        // Very basic truncation to prevent error\r\n        const cleanLine = line.replace(/[^\\x00-\\x7F]/g, \"\");\r\n        page.drawText(cleanLine.substring(0, 90), { x: 50, y, size: fontSize });\r\n        y -= 15;\r\n    }\r\n\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const convertImageOrOfficeToPdf = async (file: File): Promise<Uint8Array> => {\r\n    // Wrapper to handle different types\r\n    if (file.name.endsWith('.docx')) return wordToPdf(file);\r\n    if (file.name.endsWith('.pptx') || file.name.endsWith('.xlsx')) {\r\n        // Fallback for PPT/Excel client side (Convert to Text PDF)\r\n        // Real implementation requires heavy parsers not available in standard ESM CDN\r\n        const pdfDoc = await PDFDocument.create();\r\n        const page = pdfDoc.addPage();\r\n        page.drawText(`Conversion of ${file.name} to PDF.\\n(Preview only supports Text extraction for this format on mobile/web)`, { x: 50, y: 700, size: 12 });\r\n        return await pdfDoc.save();\r\n    }\r\n    return imageToPdf(file);\r\n};\r\n\r\n// --- HTML TO PDF ---\r\n\r\nexport const htmlToPdf = async (htmlContent: string): Promise<Uint8Array> => {\r\n    // Create a temporary container\r\n    const container = document.createElement('div');\r\n    container.innerHTML = htmlContent;\r\n    container.style.width = '595px'; // A4 width approx\r\n    container.style.padding = '20px';\r\n    container.style.background = 'white';\r\n    document.body.appendChild(container);\r\n\r\n    try {\r\n        const canvas = await html2canvas(container);\r\n        const imgData = canvas.toDataURL('image/png');\r\n\r\n        const pdf = new jsPDF();\r\n        const imgProps = pdf.getImageProperties(imgData);\r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;\r\n\r\n        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);\r\n        return new Uint8Array(pdf.output('arraybuffer'));\r\n    } finally {\r\n        document.body.removeChild(container);\r\n    }\r\n};\r\n\r\n// --- UTILS ---\r\n\r\nexport const repairPdf = async (file: File): Promise<Uint8Array> => {\r\n    // PDF-lib's ignoreEncryption option can sometimes bypass basic corruption or owner passwords\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdfDoc = await PDFDocument.load(arrayBuffer, { ignoreEncryption: true });\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const ocrPdf = async (file: File): Promise<string> => {\r\n    const images = await pdfToImages(file);\r\n    if (images.length === 0) return \"\";\r\n\r\n    const worker = await Tesseract.createWorker('eng');\r\n    let fullText = \"\";\r\n\r\n    for (const img of images) {\r\n        const ret = await worker.recognize(img);\r\n        fullText += ret.data.text + \"\\n\\n\";\r\n    }\r\n    await worker.terminate();\r\n    return fullText;\r\n};\r\n\r\n// --- EXISTING IMAGE TOOLS ---\r\n\r\nexport const getPageImage = async (file: File, pageNum: number): Promise<string> => {\r\n    const { pdfjs } = await import('react-pdf');\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n    const page = await pdf.getPage(pageNum);\r\n    const viewport = page.getViewport({ scale: 1.5 }); // Good balance for AI analysis\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = viewport.width;\r\n    canvas.height = viewport.height;\r\n\r\n    const context = canvas.getContext('2d');\r\n    if (context) {\r\n        await page.render({ canvasContext: context, viewport } as any).promise;\r\n        return canvas.toDataURL('image/jpeg', 0.8);\r\n    }\r\n    throw new Error(\"Canvas context error\");\r\n}\r\n\r\nexport const pdfToImages = async (file: File): Promise<string[]> => {\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    // Use the configured library from react-pdf\r\n    const { pdfjs } = await import('react-pdf');\r\n    const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n    const images: string[] = [];\r\n\r\n    for (let i = 1; i <= pdf.numPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const viewport = page.getViewport({ scale: 2.0 }); // Higher scale for better quality\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = viewport.width;\r\n        canvas.height = viewport.height;\r\n\r\n        const context = canvas.getContext('2d');\r\n        if (context) {\r\n            // Cast to any to handle potential type mismatch with RenderParameters\r\n            await page.render({ canvasContext: context, viewport } as any).promise;\r\n            images.push(canvas.toDataURL('image/jpeg', 0.8));\r\n        }\r\n    }\r\n    return images;\r\n};\r\n\r\nexport const createPdfFromImages = async (files: File[]): Promise<Uint8Array> => {\r\n    const pdfDoc = await PDFDocument.create();\r\n\r\n    for (const file of files) {\r\n        const buffer = await file.arrayBuffer();\r\n        let img;\r\n        try {\r\n            if (file.type === 'image/jpeg' || file.type === 'image/jpg') {\r\n                img = await pdfDoc.embedJpg(buffer);\r\n            } else if (file.type === 'image/png') {\r\n                img = await pdfDoc.embedPng(buffer);\r\n            } else {\r\n                continue;\r\n            }\r\n        } catch (e) {\r\n            console.warn(`Skipping invalid image: ${file.name}`);\r\n            continue;\r\n        }\r\n\r\n        // Add page matching image dimensions\r\n        const page = pdfDoc.addPage([img.width, img.height]);\r\n        page.drawImage(img, {\r\n            x: 0,\r\n            y: 0,\r\n            width: img.width,\r\n            height: img.height,\r\n        });\r\n    }\r\n\r\n    if (pdfDoc.getPageCount() === 0) {\r\n        throw new Error(\"No valid images were found to create PDF.\");\r\n    }\r\n\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const imageToPdf = async (file: File): Promise<Uint8Array> => {\r\n    return createPdfFromImages([file]);\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/storage.ts"],"sourcesContent":["// Simple IndexedDB helpers for storing last opened PDF bytes\r\nexport const saveFileToIDB = async (key: string, bytes: Uint8Array, name?: string) => {\r\n    return new Promise<void>((resolve, reject) => {\r\n        const openReq = indexedDB.open('extrapdf_db', 1);\r\n        openReq.onupgradeneeded = () => {\r\n            const db = openReq.result;\r\n            if (!db.objectStoreNames.contains('files')) db.createObjectStore('files');\r\n        };\r\n        openReq.onsuccess = () => {\r\n            const db = openReq.result;\r\n            const tx = db.transaction('files', 'readwrite');\r\n            const store = tx.objectStore('files');\r\n            store.put({ name: name || 'document.pdf', bytes: Array.from(bytes) }, key);\r\n            tx.oncomplete = () => { db.close(); resolve(); };\r\n            tx.onerror = () => { db.close(); reject(tx.error); };\r\n        };\r\n        openReq.onerror = () => reject(openReq.error);\r\n    });\r\n};\r\n\r\nexport const loadFileFromIDB = async (key: string): Promise<{ name: string, bytes: Uint8Array } | null> => {\r\n    return new Promise((resolve, reject) => {\r\n        const openReq = indexedDB.open('extrapdf_db', 1);\r\n        openReq.onupgradeneeded = () => {\r\n            const db = openReq.result;\r\n            if (!db.objectStoreNames.contains('files')) db.createObjectStore('files');\r\n        };\r\n        openReq.onsuccess = () => {\r\n            const db = openReq.result;\r\n            const tx = db.transaction('files', 'readonly');\r\n            const store = tx.objectStore('files');\r\n            const getReq = store.get(key);\r\n            getReq.onsuccess = () => {\r\n                const val = getReq.result;\r\n                db.close();\r\n                if (!val) return resolve(null);\r\n                resolve({ name: val.name, bytes: new Uint8Array(val.bytes) });\r\n            };\r\n            getReq.onerror = () => { db.close(); reject(getReq.error); };\r\n        };\r\n        openReq.onerror = () => reject(openReq.error);\r\n    });\r\n};\r\n\r\nexport const clearIDB = async (key: string) => {\r\n    return new Promise<void>((resolve, reject) => {\r\n        const openReq = indexedDB.open('extrapdf_db', 1);\r\n        openReq.onsuccess = () => {\r\n            const db = openReq.result;\r\n            const tx = db.transaction('files', 'readwrite');\r\n            const store = tx.objectStore('files');\r\n            store.delete(key);\r\n            tx.oncomplete = () => { db.close(); resolve(); };\r\n            tx.onerror = () => { db.close(); reject(tx.error); };\r\n        };\r\n        openReq.onerror = () => reject(openReq.error);\r\n    });\r\n};\r\n"],"names":[],"mappings":"AAAA,6DAA6D;;;;;;;;;AACtD,MAAM,gBAAgB,OAAO,KAAa,OAAmB;IAChE,OAAO,IAAI,QAAc,CAAC,SAAS;QAC/B,MAAM,UAAU,UAAU,IAAI,CAAC,eAAe;QAC9C,QAAQ,eAAe,GAAG;YACtB,MAAM,KAAK,QAAQ,MAAM;YACzB,IAAI,CAAC,GAAG,gBAAgB,CAAC,QAAQ,CAAC,UAAU,GAAG,iBAAiB,CAAC;QACrE;QACA,QAAQ,SAAS,GAAG;YAChB,MAAM,KAAK,QAAQ,MAAM;YACzB,MAAM,KAAK,GAAG,WAAW,CAAC,SAAS;YACnC,MAAM,QAAQ,GAAG,WAAW,CAAC;YAC7B,MAAM,GAAG,CAAC;gBAAE,MAAM,QAAQ;gBAAgB,OAAO,MAAM,IAAI,CAAC;YAAO,GAAG;YACtE,GAAG,UAAU,GAAG;gBAAQ,GAAG,KAAK;gBAAI;YAAW;YAC/C,GAAG,OAAO,GAAG;gBAAQ,GAAG,KAAK;gBAAI,OAAO,GAAG,KAAK;YAAG;QACvD;QACA,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;IAChD;AACJ;AAEO,MAAM,kBAAkB,OAAO;IAClC,OAAO,IAAI,QAAQ,CAAC,SAAS;QACzB,MAAM,UAAU,UAAU,IAAI,CAAC,eAAe;QAC9C,QAAQ,eAAe,GAAG;YACtB,MAAM,KAAK,QAAQ,MAAM;YACzB,IAAI,CAAC,GAAG,gBAAgB,CAAC,QAAQ,CAAC,UAAU,GAAG,iBAAiB,CAAC;QACrE;QACA,QAAQ,SAAS,GAAG;YAChB,MAAM,KAAK,QAAQ,MAAM;YACzB,MAAM,KAAK,GAAG,WAAW,CAAC,SAAS;YACnC,MAAM,QAAQ,GAAG,WAAW,CAAC;YAC7B,MAAM,SAAS,MAAM,GAAG,CAAC;YACzB,OAAO,SAAS,GAAG;gBACf,MAAM,MAAM,OAAO,MAAM;gBACzB,GAAG,KAAK;gBACR,IAAI,CAAC,KAAK,OAAO,QAAQ;gBACzB,QAAQ;oBAAE,MAAM,IAAI,IAAI;oBAAE,OAAO,IAAI,WAAW,IAAI,KAAK;gBAAE;YAC/D;YACA,OAAO,OAAO,GAAG;gBAAQ,GAAG,KAAK;gBAAI,OAAO,OAAO,KAAK;YAAG;QAC/D;QACA,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;IAChD;AACJ;AAEO,MAAM,WAAW,OAAO;IAC3B,OAAO,IAAI,QAAc,CAAC,SAAS;QAC/B,MAAM,UAAU,UAAU,IAAI,CAAC,eAAe;QAC9C,QAAQ,SAAS,GAAG;YAChB,MAAM,KAAK,QAAQ,MAAM;YACzB,MAAM,KAAK,GAAG,WAAW,CAAC,SAAS;YACnC,MAAM,QAAQ,GAAG,WAAW,CAAC;YAC7B,MAAM,MAAM,CAAC;YACb,GAAG,UAAU,GAAG;gBAAQ,GAAG,KAAK;gBAAI;YAAW;YAC/C,GAAG,OAAO,GAAG;gBAAQ,GAAG,KAAK;gBAAI,OAAO,GAAG,KAAK;YAAG;QACvD;QACA,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;IAChD;AACJ"}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/store/useFileStore.ts"],"sourcesContent":["import '@/utils/polyfill';\r\nimport { create } from 'zustand';\r\nimport { Annotation, EditableBlock } from '@/types';\r\n// @ts-ignore\r\nimport Tesseract from 'tesseract.js';\r\nimport * as Convert from '@/services/tools/convertTools';\r\nimport { saveFileToIDB, loadFileFromIDB, clearIDB } from '@/services/storage';\r\n\r\n// Worker initialized in components\r\n\r\n\r\ninterface FileState {\r\n  file: File | null;\r\n  fileName: string | null;\r\n  pdfText: string;\r\n  annotations: Annotation[];\r\n  editableBlocks: EditableBlock[]; // New: Stores OCR/Extracted blocks\r\n  numPages: number;\r\n  pageRotations: Record<number, number>;\r\n  isRestoring: boolean; // New: Loading state\r\n\r\n  // Actions\r\n  setFile: (file: File | null) => void;\r\n  // ... other actions\r\n  replaceFile: (newFileBytes: Uint8Array, name?: string) => void;\r\n  setPdfText: (text: string) => void;\r\n  addAnnotation: (ann: Annotation) => void;\r\n  updateAnnotation: (id: string, val: Partial<Annotation>) => void;\r\n  removeAnnotation: (id: string) => void;\r\n  setNumPages: (n: number) => void;\r\n  rotatePage: (page: number) => void;\r\n\r\n  // Block Actions\r\n  updateBlock: (id: string, val: Partial<EditableBlock>) => void;\r\n  deleteBlock: (id: string) => void;\r\n\r\n  reset: () => void;\r\n  // Async Actions\r\n  extractAllText: (file: File) => Promise<void>;\r\n  scanPageForBlocks: (pageNum: number) => Promise<void>;\r\n  persistState: () => Promise<void>;\r\n  restoreState: () => Promise<void>;\r\n}\r\n\r\nexport const useFileStore = create<FileState>((set, get) => ({\r\n  file: null,\r\n  fileName: null,\r\n  pdfText: \"\",\r\n  annotations: [],\r\n  editableBlocks: [],\r\n  numPages: 0,\r\n  pageRotations: {},\r\n  isRestoring: true, // Start as true\r\n\r\n  setFile: (file) => set({\r\n    file,\r\n    fileName: file?.name || null,\r\n    annotations: [],\r\n    editableBlocks: [],\r\n    pageRotations: {},\r\n    pdfText: \"\",\r\n    isRestoring: false,\r\n  }),\r\n\r\n  replaceFile: (newFileBytes, name) => {\r\n    const currentFile = get().file;\r\n    const newName = name || currentFile?.name || 'document.pdf';\r\n    const blob = new Blob([Buffer.from(newFileBytes)], { type: 'application/pdf' });\r\n    const newFile = new File([blob], newName, { type: 'application/pdf' });\r\n    set({\r\n      file: newFile,\r\n      fileName: newName,\r\n      annotations: [],\r\n      editableBlocks: [],\r\n      pageRotations: {},\r\n      pdfText: \"\"\r\n    });\r\n    // persist updated file bytes\r\n    try { saveFileToIDB('lastFile', newFileBytes, newName); } catch (e) { }\r\n  },\r\n\r\n  setPdfText: (text) => set({ pdfText: text }),\r\n\r\n  addAnnotation: (ann) => set((state) => ({ annotations: [...state.annotations, ann] })),\r\n\r\n  updateAnnotation: (id, val) => set((state) => ({\r\n    annotations: state.annotations.map((a) => (a.id === id ? { ...a, ...val } as Annotation : a))\r\n  })),\r\n\r\n  removeAnnotation: (id) => set((state) => ({\r\n    annotations: state.annotations.filter((a) => a.id !== id)\r\n  })),\r\n\r\n  updateBlock: (id, val) => set((state) => ({\r\n    editableBlocks: state.editableBlocks.map(b => b.id === id ? { ...b, ...val, isDirty: true } : b)\r\n  })),\r\n\r\n  deleteBlock: (id) => set((state) => ({\r\n    editableBlocks: state.editableBlocks.filter(b => b.id !== id)\r\n  })),\r\n\r\n  setNumPages: (n) => set({ numPages: n }),\r\n\r\n  rotatePage: (page) => set((state) => ({\r\n    pageRotations: {\r\n      ...state.pageRotations,\r\n      [page]: ((state.pageRotations[page] || 0) + 90) % 360\r\n    }\r\n  })),\r\n\r\n  reset: () => set({\r\n    file: null, fileName: null, pdfText: \"\", annotations: [], editableBlocks: [], numPages: 0, pageRotations: {}, isRestoring: false\r\n  }),\r\n\r\n  persistState: async () => {\r\n    try {\r\n      const s = {\r\n        annotations: get().annotations,\r\n        editableBlocks: get().editableBlocks,\r\n        pageRotations: get().pageRotations,\r\n        pdfText: get().pdfText,\r\n        numPages: get().numPages,\r\n        fileName: get().fileName\r\n      };\r\n      localStorage.setItem('extrapdf_state', JSON.stringify(s));\r\n      const f = get().file;\r\n      if (f) {\r\n        const bytes = new Uint8Array(await f.arrayBuffer());\r\n        await saveFileToIDB('lastFile', bytes, f.name);\r\n      }\r\n    } catch (e) { console.error('Persist Error', e); }\r\n  },\r\n\r\n  restoreState: async () => {\r\n    set({ isRestoring: true });\r\n    try {\r\n      // Initialize Worker Globally if not set\r\n      if (typeof window !== 'undefined') {\r\n        import('@/utils/pdfWorker').then(({ initPdfWorker }) => initPdfWorker());\r\n      }\r\n\r\n      const raw = localStorage.getItem('extrapdf_state');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        set({\r\n          annotations: parsed.annotations || [],\r\n          editableBlocks: parsed.editableBlocks || [],\r\n          pageRotations: parsed.pageRotations || {},\r\n          pdfText: parsed.pdfText || '',\r\n          numPages: parsed.numPages || 0,\r\n          fileName: parsed.fileName || null\r\n        });\r\n      }\r\n      const fileEntry = await loadFileFromIDB('lastFile');\r\n      if (fileEntry && fileEntry.bytes) {\r\n        const blob = new Blob([Buffer.from(fileEntry.bytes)], { type: 'application/pdf' });\r\n        const f = new File([blob], fileEntry.name, { type: 'application/pdf' });\r\n        set({ file: f, fileName: fileEntry.name });\r\n      }\r\n    } catch (e) {\r\n      console.error('Restore Error', e);\r\n    } finally {\r\n      set({ isRestoring: false });\r\n    }\r\n  },\r\n\r\n  extractAllText: async (file) => {\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      const { pdfjs } = await import('react-pdf');\r\n      const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n\r\n      let fullText = \"\";\r\n      for (let i = 1; i <= pdf.numPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n\r\n        let lastY = -1;\r\n        const pageText = textContent.items.map((item: any) => {\r\n          let str = item.str;\r\n          if (lastY !== -1 && Math.abs(item.transform[5] - lastY) > 5) {\r\n            str = '\\n' + str;\r\n          }\r\n          lastY = item.transform[5];\r\n          return str;\r\n        }).join(' ');\r\n\r\n        fullText += `--- Page ${i} ---\\n${pageText}\\n\\n`;\r\n      }\r\n      set({ pdfText: fullText });\r\n    } catch (error) {\r\n      console.error(\"Error extracting text:\", error);\r\n    }\r\n  },\r\n\r\n  scanPageForBlocks: async (pageNum: number) => {\r\n    const { file, editableBlocks } = get();\r\n    if (!file) return;\r\n\r\n    // Clear existing blocks for this page to avoid duplicates\r\n    set({ editableBlocks: editableBlocks.filter(b => b.page !== pageNum) });\r\n\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      const { pdfjs } = await import('react-pdf');\r\n      const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n      const page = await pdf.getPage(pageNum);\r\n      const viewport = page.getViewport({ scale: 1.0 });\r\n\r\n      const textContent = await page.getTextContent();\r\n\r\n      const newBlocks: EditableBlock[] = [];\r\n\r\n      // 1. Try Native Text Extraction\r\n      if (textContent.items.length > 0) {\r\n        console.log(\"Native text found, extracting...\");\r\n        // Group items by line roughly\r\n        textContent.items.forEach((item: any, idx: number) => {\r\n          if (!item.str.trim()) return;\r\n          // PDF coords (bottom-left) to Viewport coords (top-left)\r\n          // item.transform: [scaleX, skewX, skewY, scaleY, x, y]\r\n          const tx = item.transform;\r\n          const x = tx[4];\r\n          const y = viewport.height - tx[5] - item.height;\r\n\r\n          newBlocks.push({\r\n            id: `native_${pageNum}_${idx}`,\r\n            page: pageNum,\r\n            x: x,\r\n            y: y,\r\n            text: item.str,\r\n            width: item.width,\r\n            height: item.height || tx[0], // fallback to scaleY\r\n            fontSize: tx[0] || 12, // approx font size from scale\r\n            fontFamily: 'Helvetica',\r\n          });\r\n        });\r\n      } else {\r\n        // 2. Fallback to OCR (Tesseract)\r\n        console.log(\"No native text, running OCR...\");\r\n        const imgData = await Convert.getPageImage(file, pageNum);\r\n\r\n        const worker = await Tesseract.createWorker('eng');\r\n        const { data } = await worker.recognize(imgData);\r\n        await worker.terminate();\r\n\r\n        // Canvas dimensions vs Tesseract dimensions mapping\r\n        // Convert.getPageImage uses scale 1.5, so we need to adjust\r\n        const scaleFactor = 1.5;\r\n\r\n        (data as any).words.forEach((w: any, idx: number) => {\r\n          newBlocks.push({\r\n            id: `ocr_${pageNum}_${idx}`,\r\n            page: pageNum,\r\n            x: w.bbox.x0 / scaleFactor,\r\n            y: w.bbox.y0 / scaleFactor,\r\n            text: w.text,\r\n            width: (w.bbox.x1 - w.bbox.x0) / scaleFactor,\r\n            height: (w.bbox.y1 - w.bbox.y0) / scaleFactor,\r\n            fontSize: (w.bbox.y1 - w.bbox.y0) / scaleFactor * 0.8, // Approx\r\n            fontFamily: 'Courier',\r\n          });\r\n        });\r\n      }\r\n\r\n      set((state) => ({ editableBlocks: [...state.editableBlocks, ...newBlocks] }));\r\n\r\n    } catch (e) {\r\n      console.error(\"Scan Error:\", e);\r\n    }\r\n  }\r\n}));"],"names":[],"mappings":"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"}},
    {"offset": {"line": 706, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/geminiService.ts"],"sourcesContent":["import { GoogleGenAI, Chat, GenerateContentResponse, FunctionDeclaration, Type } from \"@google/genai\";\r\nimport { ChatMessage } from \"../types\";\r\n\r\n// Initialize the Gemini client\r\nconst getClient = () => {\r\n    const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;\r\n    if (!apiKey) {\r\n        console.error(\"API Key not found. Gemini features will fail.\");\r\n    }\r\n    return new GoogleGenAI({ apiKey: apiKey || '' });\r\n};\r\n\r\n// --- Tool Definitions ---\r\n\r\nconst addTextTool: FunctionDeclaration = {\r\n    name: 'edit_pdf_add_text',\r\n    description: 'Add new text to the PDF. Use this for filling forms, adding comments, or inserting headers/footers.',\r\n    parameters: {\r\n        type: Type.OBJECT,\r\n        properties: {\r\n            text: { type: Type.STRING, description: 'The text content to add.' },\r\n            page: { type: Type.NUMBER, description: 'Page number (1-based index).' },\r\n            x: { type: Type.NUMBER, description: 'X coordinate in points (0 is left). Default to 100 if unknown.' },\r\n            y: { type: Type.NUMBER, description: 'Y coordinate in points (0 is top). Default to 100 if unknown.' },\r\n            fontSize: { type: Type.NUMBER, description: 'Font size (default 14).' },\r\n            color: { type: Type.STRING, description: 'Hex color (default #000000).' }\r\n        },\r\n        required: ['text', 'page'],\r\n    },\r\n};\r\n\r\nconst cleanStampTool: FunctionDeclaration = {\r\n    name: 'clean_page_image',\r\n    description: 'Use AI Vision to detect and remove stamps, watermarks, or logos from a specific page.',\r\n    parameters: {\r\n        type: Type.OBJECT,\r\n        properties: {\r\n            page: { type: Type.NUMBER, description: 'Page number to clean (1-based index).' }\r\n        },\r\n        required: ['page']\r\n    }\r\n};\r\n\r\nconst rotatePageTool: FunctionDeclaration = {\r\n    name: 'organize_rotate_page',\r\n    description: 'Rotate a specific page by 90 degrees clockwise.',\r\n    parameters: {\r\n        type: Type.OBJECT,\r\n        properties: {\r\n            page: { type: Type.NUMBER, description: 'Page number to rotate.' }\r\n        },\r\n        required: ['page']\r\n    }\r\n};\r\n\r\nconst deletePageTool: FunctionDeclaration = {\r\n    name: 'organize_delete_page',\r\n    description: 'Delete a specific page or list of pages from the document.',\r\n    parameters: {\r\n        type: Type.OBJECT,\r\n        properties: {\r\n            pages: {\r\n                type: Type.ARRAY,\r\n                items: { type: Type.NUMBER },\r\n                description: 'Array of page numbers to delete.'\r\n            }\r\n        },\r\n        required: ['pages']\r\n    }\r\n};\r\n\r\nconst pageCountTool: FunctionDeclaration = {\r\n    name: 'get_page_count',\r\n    description: 'Get the total number of pages in the document.',\r\n    parameters: { type: Type.OBJECT, properties: {} }\r\n};\r\n\r\nexport const createChatSession = (): Chat => {\r\n    const ai = getClient();\r\n    return ai.chats.create({\r\n        model: 'gemini-2.5-flash',\r\n        config: {\r\n            systemInstruction: `You are ExtraPDF Assistant, an expert AI document editor.\r\n            \r\n            Capabilities:\r\n            1. **Edit Content**: Add text, comments, or form fills using 'edit_pdf_add_text'.\r\n            2. **Clean Up**: Remove stamps/watermarks using 'clean_page_image'.\r\n            3. **Organize**: Rotate pages ('organize_rotate_page') or delete pages ('organize_delete_page').\r\n            4. **Analyze**: Summarize or explain content based on the text provided by the user.\r\n            \r\n            Rules:\r\n            - Always confirm action completion (e.g., \"I've rotated page 3\").\r\n            - For 'clean_page_image', tell the user you are \"scanning the page for visual artifacts\".\r\n            - If the user asks to \"fix\" or \"clean\" a page, assume they mean stamp/artifact removal.\r\n            - Coordinate System: PDF origin is Top-Left. Width ~595pt.\r\n            `,\r\n            tools: [{ functionDeclarations: [addTextTool, cleanStampTool, rotatePageTool, deletePageTool, pageCountTool] }],\r\n        },\r\n    });\r\n};\r\n\r\nexport const prepareDocumentPrompt = (pdfText: string, userQuery: string, isFirstMessage: boolean): string => {\r\n    if (!isFirstMessage) return userQuery;\r\n\r\n    const MAX_CONTEXT = 50000;\r\n    const context = pdfText.length > MAX_CONTEXT ? pdfText.substring(0, MAX_CONTEXT) + \"\\n...(truncated)...\" : pdfText;\r\n    return `Context (Document Text):\\n${context}\\n\\nUser Query: ${userQuery}`;\r\n};\r\n\r\nexport const streamResponse = async (\r\n    chat: Chat,\r\n    message: string,\r\n    onChunk: (text: string) => void,\r\n    onToolCall?: (toolCall: any) => Promise<any>\r\n): Promise<void> => {\r\n    try {\r\n        const result = await chat.sendMessageStream({ message });\r\n\r\n        let fullText = \"\";\r\n\r\n        for await (const chunk of result) {\r\n            const c = chunk as GenerateContentResponse;\r\n            if (c.text) {\r\n                fullText += c.text;\r\n                onChunk(c.text);\r\n            }\r\n\r\n            const functionCalls = c.candidates?.[0]?.content?.parts?.filter(p => p.functionCall).map(p => p.functionCall);\r\n\r\n            if (functionCalls && functionCalls.length > 0 && onToolCall) {\r\n                for (const fc of functionCalls) {\r\n                    // Notify UI of tool usage via text stream\r\n                    // onChunk(`\\n(Executing ${fc.name.replace(/_/g, ' ')}...)\\n`);\r\n\r\n                    const toolResult = await onToolCall(fc);\r\n\r\n                    // Send result back to model\r\n                    const toolResponse = await chat.sendMessageStream({\r\n                        message: [{\r\n                            functionResponse: {\r\n                                name: fc?.name,\r\n                                response: { result: toolResult }\r\n                            }\r\n                        }]\r\n                    });\r\n\r\n                    // Stream the explanation after tool execution\r\n                    for await (const toolChunk of toolResponse) {\r\n                        const tc = toolChunk as GenerateContentResponse;\r\n                        if (tc.text) onChunk(tc.text);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Gemini Stream Error:\", error);\r\n        onChunk(\"\\nError: Could not complete request. Please try again.\");\r\n    }\r\n};\r\n\r\nexport const detectStamps = async (base64Image: string): Promise<Array<{ x: number, y: number, width: number, height: number }>> => {\r\n    const ai = getClient();\r\n    try {\r\n        const response = await ai.models.generateContent({\r\n            model: 'gemini-2.5-flash',\r\n            contents: {\r\n                parts: [\r\n                    { inlineData: { mimeType: 'image/jpeg', data: base64Image.split(',')[1] } },\r\n                    {\r\n                        text: `Locate visual stamps, seals, logos, or bold watermarks on this page.\r\n                             Return a JSON array of bounding boxes: [{\"ymin\": 0, \"xmin\": 0, \"ymax\": 1000, \"xmax\": 1000}].\r\n                             Normalize coordinates to 0-1000 scale.\r\n                             Rules:\r\n                             - TIGHT boxes only.\r\n                             - Ignore regular text paragraphs.\r\n                             - Focus on colored ink (red/blue) or circular seals.` }\r\n                ]\r\n            },\r\n            config: {\r\n                responseMimeType: 'application/json'\r\n            }\r\n        });\r\n\r\n        const text = response.text || \"[]\";\r\n        const boxes = JSON.parse(text);\r\n        if (!Array.isArray(boxes)) return [];\r\n\r\n        return boxes.map((b: any) => ({\r\n            x: b.xmin / 1000,\r\n            y: b.ymin / 1000,\r\n            width: (b.xmax - b.xmin) / 1000,\r\n            height: (b.ymax - b.ymin) / 1000\r\n        }));\r\n\r\n    } catch (e) {\r\n        console.error(\"Gemini Vision Error:\", e);\r\n        return [];\r\n    }\r\n};\r\n\r\n// NEW: Single text block enhancement\r\nexport const enhanceTextBlock = async (text: string, instruction: string): Promise<string> => {\r\n    const ai = getClient();\r\n    try {\r\n        const response = await ai.models.generateContent({\r\n            model: 'gemini-2.5-flash',\r\n            contents: `System: You are a text editor assistant. Improve the following text based on this instruction: \"${instruction}\". Return ONLY the improved text, no quotes, no explanations.\r\n            Text: \"${text}\"`\r\n        });\r\n        return response.text?.trim() || text;\r\n    } catch (e) {\r\n        console.error(e);\r\n        return text;\r\n    }\r\n};\r\n\r\n// NEW: Real Inpainting via Gemini\r\nexport const removeStampWithMask = async (imageBase64: string, maskBase64: string): Promise<string | null> => {\r\n    const ai = getClient();\r\n    try {\r\n        const response = await ai.models.generateContent({\r\n            // Using 2.5 Flash for vision tasks or Pro if higher quality needed.\r\n            // Note: Standard 'generateContent' with mask implies an editing task.\r\n            model: 'gemini-2.5-flash',\r\n            contents: {\r\n                parts: [\r\n                    { text: \"Remove the object covered by the white mask. Restore the background naturally to match the document paper.\" },\r\n                    { inlineData: { mimeType: 'image/png', data: imageBase64.split(',')[1] } },\r\n                    { inlineData: { mimeType: 'image/png', data: maskBase64.split(',')[1] } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        // Find the image part in the response\r\n        if (response.candidates?.[0]?.content?.parts) {\r\n            for (const part of response.candidates[0].content.parts) {\r\n                if (part.inlineData && part.inlineData.data) {\r\n                    return `data:${part.inlineData.mimeType};base64,${part.inlineData.data}`;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    } catch (e) {\r\n        console.error(\"Gemini Inpainting Error:\", e);\r\n        throw e;\r\n    }\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1016, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/components/TextBlock.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport { useDrag } from 'react-dnd';\r\nimport { EditableBlock } from '@/types';\r\nimport { Sparkles, GripVertical, Check, X } from 'lucide-react';\r\nimport { enhanceTextBlock } from '@/services/geminiService';\r\n\r\ninterface TextBlockProps {\r\n    block: EditableBlock;\r\n    zoom: number;\r\n    onUpdate: (id: string, text: string, x: number, y: number) => void;\r\n    onDelete: (id: string) => void;\r\n}\r\n\r\nexport const TextBlock: React.FC<TextBlockProps> = ({ block, zoom, onUpdate, onDelete }) => {\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [isThinking, setIsThinking] = useState(false);\r\n    const contentRef = useRef<HTMLDivElement>(null);\r\n\r\n    // React DnD Hook - Attach drag source only to the handle\r\n    const [{ isDragging }, drag, preview] = useDrag(() => ({\r\n        type: 'TEXT_BLOCK',\r\n        item: { id: block.id, type: 'TEXT_BLOCK' },\r\n        collect: (monitor) => ({\r\n            isDragging: monitor.isDragging(),\r\n        }),\r\n    }));\r\n\r\n    // Sync content from props to DOM, but ONLY when not editing to prevent overwriting user input\r\n    useEffect(() => {\r\n        if (contentRef.current && !isEditing) {\r\n            // Only update if strictly different to avoid cursor jumps or unnecessary paints\r\n            if (contentRef.current.innerText !== block.text) {\r\n                contentRef.current.innerText = block.text;\r\n            }\r\n        }\r\n    }, [block.text, isEditing]);\r\n\r\n    const handleBlur = () => {\r\n        setIsEditing(false);\r\n        if (contentRef.current) {\r\n            const newText = contentRef.current.innerText;\r\n            // Debounce update or check diff\r\n            if (newText !== block.text) {\r\n                onUpdate(block.id, newText, block.x, block.y);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleGemini = async (e: React.MouseEvent | React.TouchEvent) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        setIsThinking(true);\r\n        const currentText = contentRef.current?.innerText || block.text;\r\n        const improved = await enhanceTextBlock(currentText, \"Fix grammar and make it professional\");\r\n\r\n        if (contentRef.current) contentRef.current.innerText = improved;\r\n        onUpdate(block.id, improved, block.x, block.y);\r\n        setIsThinking(false);\r\n    };\r\n\r\n    const handleInteraction = (e: React.MouseEvent | React.TouchEvent) => {\r\n        e.stopPropagation();\r\n        setIsEditing(true);\r\n        // Delay focus to allow render cycle to apply contentEditable=true\r\n        setTimeout(() => {\r\n            contentRef.current?.focus();\r\n        }, 50);\r\n    };\r\n\r\n    return (\r\n        <div\r\n            ref={preview as any}\r\n            style={{\r\n                position: 'absolute',\r\n                left: block.x,\r\n                top: block.y,\r\n                fontSize: `${block.fontSize}px`,\r\n                // Ensure width is sufficient for editing\r\n                minWidth: '20px',\r\n                width: block.width > 20 ? 'auto' : 'auto',\r\n                maxWidth: '600px', // Prevent infinite growth\r\n                minHeight: block.height,\r\n                opacity: isDragging ? 0 : 1,\r\n                zIndex: isEditing ? 100 : 50,\r\n                transformOrigin: 'top left',\r\n            }}\r\n            className={`\r\n                group transition-all\r\n                ${isEditing\r\n                    ? 'bg-white shadow-xl ring-2 ring-primary z-50 rounded p-1'\r\n                    : 'hover:bg-primary/5 hover:ring-1 hover:ring-primary/50'\r\n                }\r\n            `}\r\n            onDoubleClick={handleInteraction}\r\n            // Add touch support for entering edit mode\r\n            onTouchEnd={(e) => {\r\n                // If it was a quick tap without drag\r\n                // For simplicity, rely on double tap logic via standard browser events or add a button\r\n            }}\r\n        >\r\n            {/* Drag Handle */}\r\n            <div\r\n                ref={drag as any}\r\n                className={`\r\n                    absolute -left-8 top-0 p-2 cursor-grab active:cursor-grabbing bg-white shadow-md rounded-l border border-gray-200\r\n                    ${isEditing || isDragging ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}\r\n                    transition-opacity touch-none\r\n                `}\r\n                style={{ touchAction: 'none' }}\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n                onTouchStart={(e) => e.stopPropagation()}\r\n            >\r\n                <GripVertical className=\"w-5 h-5 text-gray-400\" />\r\n            </div>\r\n\r\n            {/* AI Tools */}\r\n            {isEditing && (\r\n                <div\r\n                    className=\"absolute -top-12 left-0 flex items-center gap-1 bg-white shadow-lg border border-border rounded-lg p-1.5 animate-in zoom-in-95 z-[60]\"\r\n                    onMouseDown={(e) => e.stopPropagation()}\r\n                    onTouchStart={(e) => e.stopPropagation()}\r\n                >\r\n                    <button\r\n                        onClick={handleGemini}\r\n                        disabled={isThinking}\r\n                        className=\"px-2 py-1 hover:bg-purple-50 text-purple-600 rounded flex items-center gap-1 text-[10px] font-bold uppercase\"\r\n                    >\r\n                        {isThinking ? <Sparkles className=\"w-4 h-4 animate-spin\" /> : <Sparkles className=\"w-4 h-4\" />}\r\n                        AI Fix\r\n                    </button>\r\n                    <div className=\"w-px h-4 bg-gray-200\" />\r\n                    <button\r\n                        onClick={() => onDelete(block.id)}\r\n                        className=\"p-1.5 hover:bg-red-50 text-red-500 rounded\"\r\n                    >\r\n                        <X className=\"w-4 h-4\" />\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Content Area - Uncontrolled for editing */}\r\n            <div\r\n                ref={contentRef}\r\n                contentEditable={isEditing}\r\n                suppressContentEditableWarning\r\n                onBlur={handleBlur}\r\n                // Stop propagation to ensure keystrokes don't bubble to canvas listeners\r\n                onKeyDown={(e) => e.stopPropagation()}\r\n                onKeyPress={(e) => e.stopPropagation()}\r\n                onKeyUp={(e) => e.stopPropagation()}\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n                onTouchStart={(e) => e.stopPropagation()}\r\n                className={`\r\n                    outline-none whitespace-pre-wrap select-text\r\n                    ${isEditing ? 'cursor-text text-black' : 'cursor-default text-transparent selection:bg-blue-200 selection:text-black'} \r\n                `}\r\n                style={{\r\n                    fontFamily: block.fontFamily,\r\n                    // Overlay mode: text is transparent to show underlying PDF text, unless dirty/editing\r\n                    color: block.isDirty || isEditing ? 'black' : 'transparent',\r\n                    backgroundColor: block.isDirty && !isEditing ? 'white' : 'transparent',\r\n                    userSelect: 'text',\r\n                    WebkitUserSelect: 'text',\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1255, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/components/SinglePage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDrop } from 'react-dnd';\r\nimport { Page, pdfjs } from 'react-pdf';\r\nif (typeof window !== 'undefined') pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\r\nimport { ScanText, Maximize2 } from 'lucide-react';\r\nimport { TextBlock } from './TextBlock';\r\n\r\nimport \"react-pdf/dist/Page/TextLayer.css\";\r\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\r\n\r\ninterface SinglePageProps {\r\n    pageNum: number;\r\n    zoom: number;\r\n    rotation: number;\r\n    mode: string;\r\n    file: File | null;\r\n    annotations: any[];\r\n    editableBlocks: any[];\r\n    onMouseDown: (e: React.MouseEvent | React.TouchEvent, pageNum: number) => void;\r\n    onAnnotationMouseDown: (e: React.MouseEvent | React.TouchEvent, ann: any, action: 'drag' | 'resize') => void;\r\n    onContextMenu: (e: any, id: string | null, type: any) => void;\r\n    onPageSelect: (pageNum: number) => void;\r\n    isActive: boolean;\r\n    selectedId: string | null;\r\n    editingId: string | null;\r\n    currentRect: any;\r\n    currentPath: any[];\r\n    dragStart: any;\r\n    drawColor: string;\r\n    brushSize: number;\r\n    textStyle: any;\r\n    removeAnnotation: (id: string) => void;\r\n    updateAnnotation: (id: string, val: any) => void;\r\n    getFontFamily: (f: string) => string;\r\n    onBlockUpdate: (id: string, text: string, x: number, y: number) => void;\r\n    onBlockDelete: (id: string) => void;\r\n    scanPage: (pageNum: number) => Promise<void>;\r\n}\r\n\r\nconst SinglePage = React.memo(({\r\n    pageNum, zoom, rotation, mode, file, annotations, editableBlocks,\r\n    onMouseDown, onAnnotationMouseDown, onContextMenu, onPageSelect,\r\n    selectedId, editingId, currentRect, currentPath, dragStart, drawColor, brushSize, textStyle,\r\n    removeAnnotation, updateAnnotation, getFontFamily, isActive,\r\n    onBlockUpdate, onBlockDelete, scanPage\r\n}: SinglePageProps) => {\r\n    const [dimensions, setDimensions] = useState({ width: 595, height: 842 });\r\n\r\n    const [, drop] = useDrop(() => ({\r\n        accept: 'TEXT_BLOCK',\r\n        drop: (item: any, monitor) => {\r\n            const delta = monitor.getDifferenceFromInitialOffset();\r\n            const block = editableBlocks.find((b: any) => b.id === item.id);\r\n            if (block && delta) {\r\n                onBlockUpdate(block.id, block.text, block.x + delta.x / zoom, block.y + delta.y / zoom);\r\n            }\r\n        },\r\n    }), [editableBlocks, zoom]);\r\n\r\n    const onPageLoad = (page: any) => {\r\n        const viewport = page.getViewport({ scale: 1 });\r\n        const scaleFactor = 595 / viewport.width;\r\n        setDimensions({\r\n            width: 595,\r\n            height: viewport.height * scaleFactor\r\n        });\r\n    };\r\n\r\n    const isRotatedSides = rotation % 180 !== 0;\r\n    const containerStyle = {\r\n        width: isRotatedSides ? dimensions.height : dimensions.width,\r\n        height: isRotatedSides ? dimensions.width : dimensions.height,\r\n        transition: 'width 0.3s, height 0.3s'\r\n    } as React.CSSProperties;\r\n\r\n    const innerStyle: React.CSSProperties = {\r\n        width: dimensions.width,\r\n        height: dimensions.height,\r\n        transformOrigin: 'center center',\r\n        transform: `rotate(${rotation}deg)`,\r\n        position: isRotatedSides ? 'absolute' : 'relative',\r\n        left: isRotatedSides ? '50%' : 'auto',\r\n        top: isRotatedSides ? '50%' : 'auto',\r\n        translate: isRotatedSides ? '-50% -50%' : 'none',\r\n        transition: 'transform 0.3s ease-out'\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (mode === 'edit_text' && isActive && editableBlocks.filter((b: any) => b.page === pageNum).length === 0) {\r\n            scanPage(pageNum);\r\n        }\r\n    }, [mode, isActive, pageNum]);\r\n\r\n    return (\r\n        <div\r\n            id={`page-wrapper-${pageNum}`}\r\n            className={`relative rounded-sm overflow-hidden group/page bg-white transition-all mx-auto my-4 border-2 \r\n        ${isActive ? 'border-primary shadow-2xl ring-4 ring-primary/10' : 'border-transparent shadow-xl hover:shadow-2xl'}`}\r\n            style={containerStyle}\r\n            onMouseDown={(e) => onMouseDown(e, pageNum)}\r\n            onTouchStart={(e) => onMouseDown(e, pageNum)}\r\n            onContextMenu={(e) => { e.preventDefault(); e.stopPropagation(); onContextMenu(e, null, 'canvas'); }}\r\n        >\r\n            <div style={{ width: '100%', height: '100%', transform: `scale(${zoom})`, transformOrigin: 'top center' }}>\r\n                <div style={innerStyle} ref={drop as any}>\r\n                    <Page\r\n                        pageNumber={pageNum}\r\n                        width={595}\r\n                        renderTextLayer={mode !== 'edit_text'}\r\n                        renderAnnotationLayer={false}\r\n                        className={`bg-white ${mode === 'edit_text' ? 'opacity-50' : ''}`}\r\n                        onLoadSuccess={onPageLoad}\r\n                    />\r\n\r\n                    {/* EDIT TEXT LAYER */}\r\n                    {mode === 'edit_text' && (\r\n                        <div className=\"absolute inset-0 z-30\">\r\n                            {editableBlocks.length === 0 && isActive && (\r\n                                <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                                    <div className=\"bg-black/70 text-white px-4 py-2 rounded-full flex items-center gap-2 animate-pulse\">\r\n                                        <ScanText className=\"w-4 h-4\" /> Scanning Text...\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                            {editableBlocks.filter((b: any) => b.page === pageNum).map((block: any) => (\r\n                                <TextBlock\r\n                                    key={block.id}\r\n                                    block={block}\r\n                                    zoom={zoom}\r\n                                    onUpdate={onBlockUpdate}\r\n                                    onDelete={onBlockDelete}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Interactive Overlay (Normal Annotations) */}\r\n                    <div\r\n                        id={`page-${pageNum}-overlay`}\r\n                        className={`absolute inset-0 z-10 ${mode === 'edit_text' ? 'pointer-events-none' : ''}`}\r\n                        style={{\r\n                            touchAction: (['draw', 'sign', 'whiteout', 'replace', 'redact', 'crop', 'stamp_remover'].includes(mode)) ? 'none' : 'manipulation',\r\n                            cursor: mode === 'draw' || mode === 'sign' ? 'crosshair' : mode === 'crop' || mode === 'stamp_remover' ? 'cell' : mode === 'text' ? 'text' : mode === 'cursor' ? 'default' : 'pointer'\r\n                        }}\r\n                        onMouseDown={(e) => onMouseDown(e, pageNum)}\r\n                        onTouchStart={(e) => onMouseDown(e, pageNum)}\r\n                        onContextMenu={(e) => e.stopPropagation()}\r\n                    >\r\n                        {/* SVG Layer for Drawings */}\r\n                        <svg className=\"absolute inset-0 w-full h-full pointer-events-none\" style={{ zIndex: 5 }}>\r\n                            {annotations.filter((a: any) => a.page === pageNum && (a.type === 'drawing' || a.type === 'signature')).map((a: any) => (\r\n                                <polyline\r\n                                    key={a.id}\r\n                                    points={(a as any).points.map((p: any) => `${p.x},${p.y}`).join(' ')}\r\n                                    fill=\"none\" stroke={(a as any).color} strokeWidth={(a as any).thickness} strokeLinecap=\"round\" strokeLinejoin=\"round\"\r\n                                    style={{ pointerEvents: (mode === 'cursor' || mode === 'eraser') ? 'auto' : 'none', cursor: mode === 'eraser' ? 'crosshair' : 'pointer' }}\r\n                                    onMouseDown={(e) => onAnnotationMouseDown(e, a, 'drag')}\r\n                                    onTouchStart={(e) => onAnnotationMouseDown(e, a, 'drag')}\r\n                                    onMouseEnter={() => mode === 'eraser' && removeAnnotation(a.id)}\r\n                                />\r\n                            ))}\r\n                            {(mode === 'draw' || mode === 'sign') && currentPath.length > 0 && dragStart?.page === pageNum && (\r\n                                <polyline\r\n                                    points={currentPath.map((p: any) => `${p.x},${p.y}`).join(' ')}\r\n                                    fill=\"none\" stroke={mode === 'sign' ? '#000000' : drawColor} strokeWidth={mode === 'sign' ? 2 : brushSize} strokeLinecap=\"round\"\r\n                                />\r\n                            )}\r\n                        </svg>\r\n\r\n                        {/* HTML Layer for Elements */}\r\n                        {annotations.filter((a: any) => a.page === pageNum && a.type !== 'drawing' && a.type !== 'signature').map((ann: any) => {\r\n                            const isSelected = selectedId === ann.id;\r\n                            return (\r\n                                <div\r\n                                    key={ann.id}\r\n                                    className={`\r\n                    absolute group transition-shadow \r\n                    ${isSelected ? 'ring-1 ring-primary ring-offset-1' : ''}\r\n                    ${mode === 'cursor' ? 'hover:ring-1 hover:ring-primary/50 cursor-move' : ''}\r\n                  `}\r\n                                    style={{\r\n                                        left: ann.x, top: ann.y,\r\n                                        width: (ann as any).width || 200, height: (ann as any).height || 50,\r\n                                        pointerEvents: 'auto',\r\n                                        zIndex: 20\r\n                                    }}\r\n                                    onMouseDown={(e) => onAnnotationMouseDown(e, ann, 'drag')}\r\n                                    onTouchStart={(e) => onAnnotationMouseDown(e, ann, 'drag')}\r\n                                    onMouseEnter={() => mode === 'eraser' && removeAnnotation(ann.id)}\r\n                                    onContextMenu={(e) => {\r\n                                        e.preventDefault(); e.stopPropagation();\r\n                                        onContextMenu(e, ann.id, ann.type);\r\n                                    }}\r\n                                >\r\n                                    {isSelected && mode === 'cursor' && (\r\n                                        <div\r\n                                            className=\"absolute -bottom-2 -right-2 w-4 h-4 bg-primary rounded-full cursor-se-resize shadow-md z-50 flex items-center justify-center hover:scale-125 transition-transform\"\r\n                                            onMouseDown={(e) => onAnnotationMouseDown(e, ann, 'resize')}\r\n                                            onTouchStart={(e) => onAnnotationMouseDown(e, ann, 'resize')}\r\n                                        >\r\n                                            <Maximize2 className=\"w-2 h-2 text-white\" />\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {ann.type === 'whiteout' && <div className=\"w-full h-full bg-white border border-gray-100/50\" />}\r\n                                    {ann.type === 'redact' && <div className=\"w-full h-full bg-black\" />}\r\n\r\n                                    {ann.type === 'image' && (\r\n                                        <img src={(ann as any).dataUrl} className=\"w-full h-full object-contain select-none\" draggable={false} alt=\"inserted\" />\r\n                                    )}\r\n\r\n                                    {ann.type === 'text' && (\r\n                                        editingId === ann.id ? (\r\n                                            <textarea\r\n                                                autoFocus\r\n                                                value={ann.text}\r\n                                                onChange={(e) => updateAnnotation(ann.id, { text: e.target.value })}\r\n                                                onBlur={() => { if (!ann.text.trim()) removeAnnotation(ann.id); }}\r\n                                                placeholder=\"Type here...\"\r\n                                                style={{\r\n                                                    color: (ann as any).color, fontSize: (ann as any).size + 'px', fontFamily: getFontFamily((ann as any).fontFamily),\r\n                                                    fontWeight: (ann as any).isBold ? 'bold' : 'normal', fontStyle: (ann as any).isItalic ? 'italic' : 'normal',\r\n                                                    textDecoration: (ann as any).isUnderline ? 'underline' : 'none', textAlign: (ann as any).align || 'left',\r\n                                                }}\r\n                                                className=\"w-full h-full bg-white/90 p-2 border border-primary rounded resize-none outline-none shadow-lg pointer-events-auto text-black\"\r\n                                                onMouseDown={(e) => e.stopPropagation()}\r\n                                                onTouchStart={(e) => e.stopPropagation()}\r\n                                            />\r\n                                        ) : (\r\n                                            <div\r\n                                                className=\"w-full h-full p-2 whitespace-pre-wrap overflow-hidden\"\r\n                                                style={{\r\n                                                    color: (ann as any).color, fontSize: (ann as any).size + 'px', fontFamily: getFontFamily((ann as any).fontFamily),\r\n                                                    fontWeight: (ann as any).isBold ? 'bold' : 'normal', fontStyle: (ann as any).isItalic ? 'italic' : 'normal',\r\n                                                    textDecoration: (ann as any).isUnderline ? 'underline' : 'none', textAlign: (ann as any).align || 'left',\r\n                                                }}\r\n                                            >\r\n                                                {ann.text || <span className=\"text-gray-400 italic bg-white/80 px-2 py-1 border border-dashed border-gray-300 rounded shadow-sm block w-full\">Type text...</span>}\r\n                                            </div>\r\n                                        )\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Selection Rect */}\r\n                        {currentRect && currentRect.page === pageNum && (\r\n                            <div className={`\r\n                absolute border-2\r\n                ${mode === 'redact' ? 'bg-black/50 border-black' :\r\n                                    mode === 'crop' ? 'bg-black/10 border-dashed border-primary' :\r\n                                        mode === 'stamp_remover' ? 'bg-purple-500/20 border-purple-500 animate-pulse' :\r\n                                            'bg-primary/20 border-primary'}\r\n              `} style={{ left: currentRect.x, top: currentRect.y, width: currentRect.w, height: currentRect.h }}>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\n\r\nexport default SinglePage;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1662, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/PDFCanvas.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport dynamic from 'next/dynamic';\r\nimport { pdfjs ,Document,Page} from 'react-pdf';\r\n// Dynamic Import for PDF Components to avoid SSR/Worker issues\r\nconst PDFDocument = dynamic(async () => {\r\n    if (typeof window !== 'undefined') pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\r\n    return Document;\r\n}, { ssr: false });\r\nconst PDFPage = dynamic(async () => {\r\n    return Page;\r\n}, { ssr: false });\r\n\r\nimport { DndProvider, useDrop } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\nimport { TouchBackend } from 'react-dnd-touch-backend';\r\nimport { useFileStore } from '@/store/useFileStore';\r\nimport { EditorMode } from '@/types';\r\nimport { ContextMenu } from './ContextMenu';\r\nimport { Maximize2, ZoomIn, ZoomOut, ScanText } from 'lucide-react';\r\nimport { TextBlock } from './components/TextBlock';\r\nimport SinglePage from './components/SinglePage';\r\n\r\ninterface PDFCanvasProps {\r\n    zoom: number;\r\n    setZoom: (z: number) => void;\r\n    mode: EditorMode;\r\n    activePage?: number;\r\n    onPageSelect?: (page: number) => void;\r\n    pendingImage: string | null;\r\n    onImagePlaced: () => void;\r\n    drawColor: string;\r\n    brushSize: number;\r\n    textStyle: any;\r\n    onStampRemove: (pageNum: number, rect?: { x: number, y: number, w: number, h: number }) => void;\r\n    onAnnotationSelect?: (ann: any | null) => void;\r\n    onCropApply?: (pageNum: number, rect: { x: number, y: number, w: number, h: number }) => void;\r\n}\r\n\r\n// SinglePage is now extracted to components/SinglePage.tsx\r\n\r\nexport const PDFCanvas: React.FC<PDFCanvasProps> = ({\r\n    zoom, setZoom, mode, activePage = 1, onPageSelect, pendingImage, onImagePlaced,\r\n    drawColor, brushSize, textStyle, onStampRemove, onAnnotationSelect, onCropApply\r\n}) => {\r\n    const {\r\n        file, annotations, addAnnotation, updateAnnotation, removeAnnotation,\r\n        extractAllText, setNumPages, numPages, pageRotations,\r\n        editableBlocks, updateBlock, deleteBlock, scanPageForBlocks\r\n    } = useFileStore();\r\n\r\n    const [editingId, setEditingId] = useState<string | null>(null);\r\n    const [selectedId, setSelectedId] = useState<string | null>(null);\r\n\r\n    // Interaction State\r\n    const [interactionState, setInteractionState] = useState<'none' | 'drawing' | 'dragging' | 'resizing' | 'zooming'>('none');\r\n    const [dragStart, setDragStart] = useState<{ x: number, y: number, page: number } | null>(null);\r\n    const [initialAnnState, setInitialAnnState] = useState<any>(null);\r\n    const [currentRect, setCurrentRect] = useState<{ x: number, y: number, w: number, h: number, page: number } | null>(null);\r\n    const [currentPath, setCurrentPath] = useState<{ x: number, y: number }[]>([]);\r\n    const [contextMenu, setContextMenu] = useState<{ x: number, y: number, id: string | null, type: any } | null>(null);\r\n\r\n    const placingImageRef = useRef(false);\r\n\r\n    // Pinch Zoom Refs\r\n    const initialTouchDist = useRef<number>(0);\r\n    const initialZoom = useRef<number>(1);\r\n\r\n    // Determine Backend based on device capability\r\n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n    const Backend = isTouchDevice ? TouchBackend : HTML5Backend;\r\n    const backendOptions = { enableMouseEvents: true };\r\n\r\n    useEffect(() => {\r\n        if (file) extractAllText(file);\r\n    }, [file]);\r\n\r\n    const getRelativeCoords = (clientX: number, clientY: number, pageElement: HTMLElement) => {\r\n        const rect = pageElement.getBoundingClientRect();\r\n        return {\r\n            x: (clientX - rect.left) / zoom,\r\n            y: (clientY - rect.top) / zoom\r\n        };\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleGlobalMove = (e: MouseEvent | TouchEvent) => {\r\n            if (interactionState === 'none') return;\r\n\r\n            // Pinch Zoom Logic\r\n            if (interactionState === 'zooming' && 'touches' in e && e.touches.length === 2) {\r\n                e.preventDefault();\r\n                const dist = Math.hypot(\r\n                    e.touches[0].clientX - e.touches[1].clientX,\r\n                    e.touches[0].clientY - e.touches[1].clientY\r\n                );\r\n                if (initialTouchDist.current > 0) {\r\n                    const scale = dist / initialTouchDist.current;\r\n                    setZoom(Math.min(Math.max(initialZoom.current * scale, 0.5), 3));\r\n                }\r\n                return;\r\n            }\r\n\r\n            const clientX = 'touches' in e ? e.touches[0].clientX : (e as MouseEvent).clientX;\r\n            const clientY = 'touches' in e ? e.touches[0].clientY : (e as MouseEvent).clientY;\r\n\r\n            if (dragStart) {\r\n                const pageEl = document.getElementById(`page-${dragStart.page}-overlay`);\r\n                if (!pageEl) return;\r\n                const coords = getRelativeCoords(clientX, clientY, pageEl);\r\n\r\n                if (interactionState === 'drawing') {\r\n                    e.preventDefault(); // Prevent scrolling while drawing/selecting\r\n                    if (mode === 'draw' || mode === 'sign') {\r\n                        setCurrentPath(prev => [...prev, { ...coords }]);\r\n                    } else if (mode === 'whiteout' || mode === 'replace' || mode === 'redact' || mode === 'crop' || mode === 'stamp_remover') {\r\n                        const w = coords.x - dragStart.x;\r\n                        const h = coords.y - dragStart.y;\r\n                        setCurrentRect({\r\n                            x: w > 0 ? dragStart.x : coords.x,\r\n                            y: h > 0 ? dragStart.y : coords.y,\r\n                            w: Math.abs(w), h: Math.abs(h), page: dragStart.page\r\n                        });\r\n                    }\r\n                }\r\n                // ... existing dragging logic ...\r\n                if ((interactionState === 'dragging' || interactionState === 'resizing') && selectedId && initialAnnState) {\r\n                    e.preventDefault(); // Prevent scroll while moving items\r\n                    const dx = coords.x - dragStart.x;\r\n                    const dy = coords.y - dragStart.y;\r\n                    if (interactionState === 'dragging') {\r\n                        updateAnnotation(selectedId, { x: initialAnnState.x + dx, y: initialAnnState.y + dy });\r\n                    } else if (interactionState === 'resizing') {\r\n                        updateAnnotation(selectedId, {\r\n                            width: Math.max(20, (initialAnnState.width || 200) + dx),\r\n                            height: Math.max(20, (initialAnnState.height || 50) + dy)\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        const handleGlobalUp = (e: MouseEvent | TouchEvent) => {\r\n            if (interactionState === 'drawing' && dragStart) {\r\n                if ((mode === 'draw' || mode === 'sign') && currentPath.length > 2) {\r\n                    addAnnotation({\r\n                        id: Date.now().toString(), page: dragStart.page, type: mode === 'sign' ? 'signature' : 'drawing',\r\n                        points: currentPath, color: mode === 'sign' ? '#000000' : drawColor, thickness: mode === 'sign' ? 2 : brushSize\r\n                    });\r\n                } else if ((mode === 'whiteout' || mode === 'replace' || mode === 'redact') && currentRect && currentRect.w > 5) {\r\n                    addAnnotation({\r\n                        id: Date.now().toString() + '_bg', page: dragStart.page, type: mode === 'redact' ? 'redact' : 'whiteout',\r\n                        x: currentRect.x, y: currentRect.y, width: currentRect.w, height: currentRect.h\r\n                    });\r\n                } else if (mode === 'crop' && currentRect && currentRect.w > 20 && onCropApply) {\r\n                    if (window.confirm(\"Apply crop to this page?\")) {\r\n                        onCropApply(dragStart.page, { x: currentRect.x, y: currentRect.y, w: currentRect.w, h: currentRect.h });\r\n                    }\r\n                } else if (mode === 'stamp_remover' && currentRect && currentRect.w > 10) {\r\n                    if (window.confirm(\"Use AI to clean this area?\")) {\r\n                        onStampRemove(dragStart.page, currentRect);\r\n                    }\r\n                }\r\n            }\r\n            setInteractionState('none'); setDragStart(null); setCurrentRect(null); setCurrentPath([]); setInitialAnnState(null);\r\n        };\r\n\r\n        if (interactionState !== 'none') {\r\n            window.addEventListener('mousemove', handleGlobalMove); window.addEventListener('mouseup', handleGlobalUp);\r\n            window.addEventListener('touchmove', handleGlobalMove, { passive: false }); window.addEventListener('touchend', handleGlobalUp);\r\n        }\r\n        return () => {\r\n            window.removeEventListener('mousemove', handleGlobalMove); window.removeEventListener('mouseup', handleGlobalUp);\r\n            window.removeEventListener('touchmove', handleGlobalMove); window.removeEventListener('touchend', handleGlobalUp);\r\n        };\r\n    }, [interactionState, dragStart, selectedId, initialAnnState, currentPath, currentRect, mode, drawColor, brushSize]);\r\n\r\n    // Unified Handler for Mouse and Touch\r\n    const handleMouseDown = (e: React.MouseEvent | React.TouchEvent, pageNum: number) => {\r\n        // Detect Pinch Zoom\r\n        if ('touches' in e && e.touches.length === 2) {\r\n            setInteractionState('zooming');\r\n            initialTouchDist.current = Math.hypot(\r\n                e.touches[0].clientX - e.touches[1].clientX,\r\n                e.touches[0].clientY - e.touches[1].clientY\r\n            );\r\n            initialZoom.current = zoom;\r\n            return;\r\n        }\r\n\r\n        if (onPageSelect) onPageSelect(pageNum);\r\n        if (mode === 'edit_text') return;\r\n\r\n        // Check tool compatibility for interaction\r\n        const isInteractiveTool = ['text', 'cursor', 'draw', 'whiteout', 'sign', 'crop', 'image', 'stamp_remover'].includes(mode);\r\n        if (!isInteractiveTool) return;\r\n\r\n        const pageEl = document.getElementById(`page-${pageNum}-overlay`);\r\n        if (!pageEl) return;\r\n\r\n        const clientX = 'touches' in e ? e.touches[0].clientX : (e as React.MouseEvent).clientX;\r\n        const clientY = 'touches' in e ? e.touches[0].clientY : (e as React.MouseEvent).clientY;\r\n        const coords = getRelativeCoords(clientX, clientY, pageEl);\r\n\r\n        if (['draw', 'whiteout', 'replace', 'redact', 'sign', 'crop', 'stamp_remover'].includes(mode)) {\r\n            e.stopPropagation();\r\n            setInteractionState('drawing');\r\n            setDragStart({ ...coords, page: pageNum });\r\n            if (mode === 'draw' || mode === 'sign') setCurrentPath([{ ...coords }]);\r\n            else setCurrentRect({ ...coords, w: 0, h: 0, page: pageNum });\r\n        } else if (mode === 'text') {\r\n            // Place Text\r\n            addAnnotation({\r\n                id: Date.now().toString(),\r\n                page: pageNum,\r\n                type: 'text',\r\n                x: coords.x,\r\n                y: coords.y,\r\n                text: '',\r\n                color: drawColor,\r\n                size: textStyle.size,\r\n                ...textStyle\r\n            });\r\n            setEditingId(Date.now().toString());\r\n        } else if (mode === 'image' && pendingImage && onImagePlaced) {\r\n            // Place Image\r\n            if (placingImageRef.current) return;\r\n            placingImageRef.current = true;\r\n\r\n            const img = new Image();\r\n            img.onload = () => {\r\n                addAnnotation({\r\n                    id: Date.now().toString(), page: pageNum, type: 'image',\r\n                    x: coords.x - 50, y: coords.y - 50, width: 100, height: 100 * (img.height / img.width),\r\n                    dataUrl: pendingImage\r\n                });\r\n                onImagePlaced();\r\n                // Reset after a short delay to be safe, though mode switch usually handles it\r\n                setTimeout(() => { placingImageRef.current = false; }, 500);\r\n            };\r\n            img.src = pendingImage;\r\n        }\r\n    };\r\n\r\n    const handleAnnotationMouseDown = (e: React.MouseEvent | React.TouchEvent, ann: any, action: 'drag' | 'resize') => {\r\n        if (mode === 'edit_text') return;\r\n        e.stopPropagation(); // prevent background interaction\r\n\r\n        setSelectedId(ann.id); if (onAnnotationSelect) onAnnotationSelect(ann);\r\n        setInteractionState(action === 'drag' ? 'dragging' : 'resizing');\r\n        setInitialAnnState({ ...ann });\r\n\r\n        const pageEl = document.getElementById(`page-${ann.page}-overlay`);\r\n        if (pageEl) {\r\n            const clientX = 'touches' in e ? e.touches[0].clientX : (e as React.MouseEvent).clientX;\r\n            const clientY = 'touches' in e ? e.touches[0].clientY : (e as React.MouseEvent).clientY;\r\n            const coords = getRelativeCoords(clientX, clientY, pageEl);\r\n            setDragStart({ ...coords, page: ann.page });\r\n        }\r\n    };\r\n\r\n    const getFontFamily = (f: string) => {\r\n        switch (f) {\r\n            case 'Times': return 'Times New Roman, serif';\r\n            case 'Courier': return 'Courier New, monospace';\r\n            default: return 'Inter, Helvetica, Arial, sans-serif';\r\n        }\r\n    };\r\n\r\n    if (!file) return <div className=\"p-10 text-center text-muted-foreground animate-pulse\">Loading Document...</div>;\r\n\r\n    return (\r\n        <DndProvider backend={Backend} options={backendOptions}>\r\n            <div\r\n                className={`w-full h-full relative ${mode === 'text' ? 'mode-edit' : ''}`}\r\n                onClick={() => setContextMenu(null)}\r\n            >\r\n                <PDFDocument file={file} onLoadSuccess={({ numPages }) => setNumPages(numPages)} className=\"flex flex-col gap-6 items-center\">\r\n                    {Array.from(new Array(numPages), (_, index) => {\r\n                        const pageNum = index + 1;\r\n                        const rotation = pageRotations[pageNum] || 0;\r\n                        return (\r\n                            <SinglePage\r\n                                key={`page-${pageNum}`}\r\n                                pageNum={pageNum}\r\n                                zoom={zoom}\r\n                                rotation={rotation}\r\n                                mode={mode}\r\n                                file={file}\r\n                                annotations={annotations}\r\n                                editableBlocks={editableBlocks}\r\n                                onMouseDown={handleMouseDown}\r\n                                onAnnotationMouseDown={handleAnnotationMouseDown}\r\n                                onContextMenu={(e: any, id: string | null, type: any) => setContextMenu({ x: e.clientX, y: e.clientY, id, type })}\r\n                                onPageSelect={onPageSelect || (() => { })}\r\n                                isActive={pageNum === activePage}\r\n                                selectedId={selectedId}\r\n                                editingId={editingId}\r\n                                currentRect={currentRect}\r\n                                currentPath={currentPath}\r\n                                dragStart={dragStart}\r\n                                drawColor={drawColor}\r\n                                brushSize={brushSize}\r\n                                textStyle={textStyle}\r\n                                removeAnnotation={removeAnnotation}\r\n                                updateAnnotation={updateAnnotation}\r\n                                getFontFamily={getFontFamily}\r\n                                // DND\r\n                                onBlockUpdate={(id: string, text: string, x: number, y: number) => updateBlock(id, { text, x, y })}\r\n                                onBlockDelete={(id: string) => deleteBlock(id)}\r\n                                scanPage={scanPageForBlocks}\r\n                            />\r\n                        );\r\n                    })}\r\n                </PDFDocument>\r\n                {/* ... controls ... */}\r\n            </div>\r\n        </DndProvider>\r\n    );\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2095, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/store/useSettingsStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { AppSettings } from '@/types';\r\n\r\ninterface SettingsState {\r\n    settings: AppSettings;\r\n    updateSettings: (newSettings: Partial<AppSettings>) => void;\r\n    toggleTheme: () => void;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: AppSettings = {\r\n    theme: 'light',\r\n    autoCompress: false,\r\n    aiThinking: true,\r\n    permissions: {\r\n        printing: true,\r\n        copying: true,\r\n        modifying: false\r\n    },\r\n    density: 'comfortable',\r\n    defaultPassword: ''\r\n};\r\n\r\nexport const useSettingsStore = create<SettingsState>()(\r\n    persist(\r\n        (set, get) => ({\r\n            settings: DEFAULT_SETTINGS,\r\n            updateSettings: (newValues) => set((state) => {\r\n                const updated = { ...state.settings, ...newValues };\r\n                // Apply theme side-effect\r\n                if (newValues.theme) {\r\n                    const root = document.documentElement;\r\n                    if (newValues.theme === 'dark') {\r\n                        root.classList.add('dark');\r\n                        root.classList.remove('light');\r\n                    } else {\r\n                        root.classList.add('light');\r\n                        root.classList.remove('dark');\r\n                    }\r\n                }\r\n                return { settings: updated };\r\n            }),\r\n            toggleTheme: () => {\r\n                const current = get().settings.theme;\r\n                const next = current === 'light' ? 'dark' : 'light';\r\n                get().updateSettings({ theme: next });\r\n            }\r\n        }),\r\n        {\r\n            name: 'extrapdf_settings_storage',\r\n        }\r\n    )\r\n);\r\n\r\n// Initialize theme on load\r\nconst saved = localStorage.getItem('extrapdf_settings_storage');\r\nif (saved) {\r\n    try {\r\n        const parsed = JSON.parse(saved);\r\n        const theme = parsed.state.settings.theme;\r\n        if (theme === 'dark') document.documentElement.classList.add('dark');\r\n    } catch (e) { }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AASA,MAAM,mBAAgC;IAClC,OAAO;IACP,cAAc;IACd,YAAY;IACZ,aAAa;QACT,UAAU;QACV,SAAS;QACT,WAAW;IACf;IACA,SAAS;IACT,iBAAiB;AACrB;AAEO,MAAM,mBAAmB,IAAA,kQAAM,IAClC,IAAA,wQAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,UAAU;QACV,gBAAgB,CAAC,YAAc,IAAI,CAAC;gBAChC,MAAM,UAAU;oBAAE,GAAG,MAAM,QAAQ;oBAAE,GAAG,SAAS;gBAAC;gBAClD,0BAA0B;gBAC1B,IAAI,UAAU,KAAK,EAAE;oBACjB,MAAM,OAAO,SAAS,eAAe;oBACrC,IAAI,UAAU,KAAK,KAAK,QAAQ;wBAC5B,KAAK,SAAS,CAAC,GAAG,CAAC;wBACnB,KAAK,SAAS,CAAC,MAAM,CAAC;oBAC1B,OAAO;wBACH,KAAK,SAAS,CAAC,GAAG,CAAC;wBACnB,KAAK,SAAS,CAAC,MAAM,CAAC;oBAC1B;gBACJ;gBACA,OAAO;oBAAE,UAAU;gBAAQ;YAC/B;QACA,aAAa;YACT,MAAM,UAAU,MAAM,QAAQ,CAAC,KAAK;YACpC,MAAM,OAAO,YAAY,UAAU,SAAS;YAC5C,MAAM,cAAc,CAAC;gBAAE,OAAO;YAAK;QACvC;IACJ,CAAC,GACD;IACI,MAAM;AACV;AAIR,2BAA2B;AAC3B,MAAM,QAAQ,aAAa,OAAO,CAAC;AACnC,IAAI,OAAO;IACP,IAAI;QACA,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,MAAM,QAAQ,OAAO,KAAK,CAAC,QAAQ,CAAC,KAAK;QACzC,IAAI,UAAU,QAAQ,SAAS,eAAe,CAAC,SAAS,CAAC,GAAG,CAAC;IACjE,EAAE,OAAO,GAAG,CAAE;AAClB"}},
    {"offset": {"line": 2163, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/components/EditorSidebar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react';\r\nimport { Tool, ToolCategory } from '@/types';\r\nimport {\r\n    MousePointer, Type, Eraser, PenLine, Scissors, Merge,\r\n    Shield, RotateCw, FileImage, Layers, Trash, Stamp,\r\n    Image as ImageIcon, AlignLeft, Info, FileStack,\r\n    Hash, FileOutput, Wand2, FileText, FileMinus\r\n} from 'lucide-react';\r\nimport { useSettingsStore } from '@/store/useSettingsStore';\r\n\r\ninterface SidebarProps {\r\n    activeCategory: ToolCategory;\r\n    setActiveCategory: (c: ToolCategory) => void;\r\n    activeToolId: string;\r\n    onToolSelect: (t: Tool) => void;\r\n}\r\n\r\nexport const toolsList: Tool[] = [\r\n    // ORGANIZE\r\n    { id: 'merge', label: 'Merge', icon: Merge, category: 'organize', description: 'Combine PDFs' },\r\n    { id: 'split', label: 'Split', icon: Scissors, category: 'organize', description: 'Extract pages', requiresModal: true },\r\n    { id: 'remove_empty', label: 'Remove Empty', icon: FileMinus, category: 'organize', description: 'Auto-delete blank' },\r\n    { id: 'reorder', label: 'Reorder', icon: FileStack, category: 'organize', description: 'Move pages', requiresModal: true },\r\n    { id: 'rotate', label: 'Rotate', icon: RotateCw, category: 'organize', description: 'Rotate Page' },\r\n    { id: 'delete_page', label: 'Delete', icon: Trash, category: 'organize', description: 'Remove Page', requiresModal: true },\r\n    { id: 'page_numbers', label: 'Numbers', icon: Hash, category: 'organize', description: 'Add Footer' },\r\n\r\n    // EDIT\r\n    { id: 'cursor', label: 'Select', icon: MousePointer, category: 'edit', description: 'Select' },\r\n    { id: 'edit_text', label: 'Edit Text', icon: FileText, category: 'edit', description: 'Edit Existing' }, // NEW\r\n    { id: 'text', label: 'Add Text', icon: Type, category: 'edit', description: 'Add Text' },\r\n    { id: 'draw', label: 'Draw', icon: PenLine, category: 'edit', description: 'Freehand' },\r\n    { id: 'eraser', label: 'Eraser', icon: Eraser, category: 'edit', description: 'Delete Drawing' },\r\n    { id: 'whiteout', label: 'Whiteout', icon: AlignLeft, category: 'edit', description: 'Cover Text' },\r\n    { id: 'add_image', label: 'Image', icon: ImageIcon, category: 'edit', description: 'Add Image' },\r\n    { id: 'watermark', label: 'Stamp', icon: Stamp, category: 'edit', description: 'Watermark', requiresModal: true },\r\n    { id: 'stamp_remover', label: 'Clean AI', icon: Wand2, category: 'edit', description: 'Remove Stamp' },\r\n\r\n    // SECURITY\r\n    { id: 'encrypt', label: 'Encrypt', icon: Shield, category: 'security', description: 'Password', requiresModal: true },\r\n    { id: 'flatten', label: 'Flatten', icon: Layers, category: 'security', description: 'Flatten' },\r\n    { id: 'metadata', label: 'Meta', icon: Info, category: 'security', description: 'Metadata', requiresModal: true },\r\n\r\n    // CONVERT\r\n    { id: 'pdf_to_word', label: 'Word', icon: FileImage, category: 'convert', description: 'To DOCX' },\r\n    { id: 'pdf_to_jpg', label: 'JPG', icon: FileOutput, category: 'convert', description: 'To Images' },\r\n];\r\n\r\nexport const EditorSidebar: React.FC<SidebarProps> = ({ activeCategory, setActiveCategory, activeToolId, onToolSelect }) => {\r\n    const { settings } = useSettingsStore();\r\n    const categories: ToolCategory[] = ['edit', 'organize', 'security', 'convert'];\r\n    const isCompact = settings.density === 'compact';\r\n\r\n    return (\r\n        <div className={`\r\n        w-20 h-full flex flex-col items-center shrink-0 z-20 shadow-xl transition-all border-r\r\n        bg-white/60 dark:bg-black/60 backdrop-blur-xl border-white/20\r\n        ${isCompact ? 'py-2 gap-3' : 'py-4 gap-6'}\r\n    `}>\r\n            {/* Categories */}\r\n            <div className={`flex flex-col w-full px-2 no-scrollbar ${isCompact ? 'gap-1' : 'gap-3'}`}>\r\n                {categories.map(cat => (\r\n                    <button\r\n                        key={cat}\r\n                        onClick={() => setActiveCategory(cat)}\r\n                        className={`\r\n                        rounded-2xl flex items-center justify-center transition-all duration-300 mx-auto\r\n                        ${isCompact ? 'w-10 h-10' : 'w-12 h-12'}\r\n                        ${activeCategory === cat\r\n                                ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/25 scale-105'\r\n                                : 'text-muted-foreground hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105'\r\n                            }\r\n                    `}\r\n                        title={cat.toUpperCase()}\r\n                    >\r\n                        {cat === 'edit' && <PenLine className={isCompact ? \"w-4 h-4\" : \"w-5 h-5\"} />}\r\n                        {cat === 'organize' && <Layers className={isCompact ? \"w-4 h-4\" : \"w-5 h-5\"} />}\r\n                        {cat === 'security' && <Shield className={isCompact ? \"w-4 h-4\" : \"w-5 h-5\"} />}\r\n                        {cat === 'convert' && <FileImage className={isCompact ? \"w-4 h-4\" : \"w-5 h-5\"} />}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"w-10 h-px bg-white/20 my-2\" />\r\n\r\n            {/* Tools in Category */}\r\n            <div className={`flex-1 w-full flex flex-col overflow-y-auto px-2 pb-20 no-scrollbar ${isCompact ? 'gap-1' : 'gap-2'}`}>\r\n                {toolsList.filter(t => t.category === activeCategory).map(tool => (\r\n                    <button\r\n                        key={tool.id}\r\n                        onClick={() => onToolSelect(tool)}\r\n                        className={`\r\n                        group relative w-full aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all\r\n                        ${activeToolId === tool.id\r\n                                ? 'bg-primary/10 text-primary border border-primary/20 shadow-inner'\r\n                                : 'text-muted-foreground hover:bg-black/5 dark:hover:bg-white/10 hover:text-foreground'\r\n                            }\r\n                    `}\r\n                    >\r\n                        <tool.icon className={isCompact ? \"w-4 h-4\" : \"w-5 h-5\"} />\r\n                        <span className=\"text-[9px] font-medium opacity-0 group-hover:opacity-100 absolute -bottom-2 bg-white/90 dark:bg-black/90 px-1 rounded shadow-sm transition-opacity pointer-events-none whitespace-nowrap z-50 border border-white/10\">\r\n                            {tool.label}\r\n                        </span>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2487, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/components/ThumbnailSidebar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react';\r\nimport dynamic from 'next/dynamic';\r\nimport { useFileStore } from '@/store/useFileStore';\r\n\r\nconst PDFDocument = dynamic(async () => {\r\n    const mod = await import('react-pdf');\r\n    if (typeof window !== 'undefined') mod.pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${mod.pdfjs.version}/build/pdf.worker.min.mjs`;\r\n    return mod.Document;\r\n}, { ssr: false });\r\n\r\nconst PDFPage = dynamic(() => import('react-pdf').then(mod => mod.Page), {\r\n    ssr: false,\r\n    loading: () => <div className=\"w-full h-full bg-muted/20 animate-pulse\" />\r\n});\r\n\r\ninterface ThumbnailSidebarProps {\r\n    onPageClick: (page: number) => void;\r\n    currentPageView: number; // Currently visible page in viewport\r\n}\r\n\r\nexport const ThumbnailSidebar: React.FC<ThumbnailSidebarProps> = ({ onPageClick, currentPageView }) => {\r\n    const { file, numPages } = useFileStore();\r\n\r\n    if (!file) return null;\r\n\r\n    return (\r\n        <div className=\"w-32 h-full bg-muted/30 border-r border-border flex flex-col overflow-y-auto scroll-smooth\">\r\n            <div className=\"p-4\">\r\n                <h3 className=\"text-xs font-bold uppercase text-muted-foreground mb-4 tracking-wider\">Pages</h3>\r\n                <PDFDocument file={file} className=\"space-y-4\">\r\n                    {Array.from(new Array(numPages), (_, index) => {\r\n                        const pageNum = index + 1;\r\n                        return (\r\n                            <div\r\n                                key={pageNum}\r\n                                onClick={() => onPageClick(pageNum)}\r\n                                className={`\r\n                                    relative group cursor-pointer transition-all duration-200\r\n                                    ${currentPageView === pageNum ? 'ring-2 ring-primary scale-105' : 'hover:bg-black/5'}\r\n                                `}\r\n                            >\r\n                                <div className=\"rounded-lg overflow-hidden border border-border shadow-sm bg-white aspect-[1/1.4] relative\">\r\n                                    <PDFPage\r\n                                        pageNumber={pageNum}\r\n                                        width={100}\r\n                                        renderTextLayer={false}\r\n                                        renderAnnotationLayer={false}\r\n                                        className=\"pointer-events-none\"\r\n                                    />\r\n                                </div>\r\n                                <span className=\"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[10px] font-medium text-muted-foreground\">\r\n                                    {pageNum}\r\n                                </span>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </PDFDocument>\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":";;;;;AAGA;AACA;;;;;AAJA;;;AAMA,MAAM,cAAc,IAAA,4RAAO,EAAC;IACxB,MAAM,MAAM;IACZ,wCAAmC,IAAI,KAAK,CAAC,mBAAmB,CAAC,SAAS,GAAG,CAAC,uBAAuB,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,yBAAyB,CAAC;IACnJ,OAAO,IAAI,QAAQ;AACvB;;;;;;IAAK,KAAK;;KAJJ;AAMN,MAAM,UAAU,IAAA,4RAAO,EAAC,IAAM,sNAAoB,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI;;;;;;IAClE,KAAK;IACL,SAAS,kBAAM,4SAAC;YAAI,WAAU;;;;;;;MAF5B;AAUC,MAAM,mBAAoD,CAAC,EAAE,WAAW,EAAE,eAAe,EAAE;;IAC9F,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,IAAA,+IAAY;IAEvC,IAAI,CAAC,MAAM,OAAO;IAElB,qBACI,4SAAC;QAAI,WAAU;kBACX,cAAA,4SAAC;YAAI,WAAU;;8BACX,4SAAC;oBAAG,WAAU;8BAAwE;;;;;;8BACtF,4SAAC;oBAAY,MAAM;oBAAM,WAAU;8BAC9B,MAAM,IAAI,CAAC,IAAI,MAAM,WAAW,CAAC,GAAG;wBACjC,MAAM,UAAU,QAAQ;wBACxB,qBACI,4SAAC;4BAEG,SAAS,IAAM,YAAY;4BAC3B,WAAW,CAAC;;oCAER,EAAE,oBAAoB,UAAU,kCAAkC,mBAAmB;gCACzF,CAAC;;8CAED,4SAAC;oCAAI,WAAU;8CACX,cAAA,4SAAC;wCACG,YAAY;wCACZ,OAAO;wCACP,iBAAiB;wCACjB,uBAAuB;wCACvB,WAAU;;;;;;;;;;;8CAGlB,4SAAC;oCAAK,WAAU;8CACX;;;;;;;2BAjBA;;;;;oBAqBjB;;;;;;;;;;;;;;;;;AAKpB;GAxCa;;QACkB,+IAAY;;;MAD9B"}},
    {"offset": {"line": 2626, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/components/EditorToolbar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react';\r\nimport { EditorMode } from '@/types';\r\nimport {\r\n    Download, CheckCircle2, Eraser,\r\n    Bold, Italic, Underline, AlignLeft, AlignCenter, AlignRight,\r\n    Wand2, Sparkles, ScanText\r\n} from 'lucide-react';\r\n\r\ninterface ToolbarProps {\r\n    mode: EditorMode | string;\r\n    // New prop to know what kind of item is selected\r\n    selectedAnnotationType: 'text' | 'drawing' | 'image' | 'whiteout' | null;\r\n\r\n    zoom: number;\r\n    setZoom: (z: number) => void;\r\n    onAction: (action: string) => void;\r\n    onExport: () => void;\r\n    status?: string;\r\n\r\n    // Drawing Props\r\n    drawColor: string;\r\n    setDrawColor: (c: string) => void;\r\n    brushSize: number;\r\n    setBrushSize: (s: number) => void;\r\n\r\n    // Text Props\r\n    textStyle: {\r\n        fontFamily: 'Helvetica' | 'Times' | 'Courier';\r\n        isBold: boolean;\r\n        isItalic: boolean;\r\n        isUnderline: boolean;\r\n        align: 'left' | 'center' | 'right';\r\n        size: number;\r\n    };\r\n    setTextStyle: (style: any) => void;\r\n}\r\n\r\nexport const EditorToolbar: React.FC<ToolbarProps> = ({\r\n    mode, selectedAnnotationType, zoom, setZoom, onAction, onExport, status,\r\n    drawColor, setDrawColor, brushSize, setBrushSize,\r\n    textStyle, setTextStyle\r\n}) => {\r\n\r\n    const colors = ['#000000', '#FF0000', '#0000FF', '#008000', '#FFA500', '#800080'];\r\n\r\n    const updateTextStyle = (key: string, val: any) => {\r\n        setTextStyle((prev: any) => ({ ...prev, [key]: val }));\r\n    };\r\n\r\n    const renderToolSpecifics = () => {\r\n        // Edit Text Mode\r\n        if (mode === 'edit_text') {\r\n            return (\r\n                <div className=\"flex items-center gap-2 px-4 py-1.5 bg-blue-500/10 text-blue-600 rounded-full border border-blue-200/50 backdrop-blur-sm animate-in slide-in-from-top-2\">\r\n                    <ScanText className=\"w-4 h-4\" />\r\n                    <span className=\"text-xs font-bold\">Edit Mode: Text is extracted. Drag or double-click to edit.</span>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        // ... (Keep existing conditionals for other modes)\r\n        if (mode === 'text' || (mode === 'cursor' && selectedAnnotationType === 'text')) {\r\n            return (\r\n                <div className=\"flex items-center gap-3 px-4 py-1.5 bg-white/40 dark:bg-black/40 backdrop-blur-md rounded-full border border-white/20 animate-in slide-in-from-top-2 shadow-sm\">\r\n                    {mode === 'cursor' && <span className=\"text-[10px] font-bold text-primary uppercase mr-2\">Edit Text</span>}\r\n                    {/* ... Text Controls ... */}\r\n                    <select\r\n                        value={textStyle.fontFamily}\r\n                        onChange={(e) => updateTextStyle('fontFamily', e.target.value)}\r\n                        className=\"bg-transparent text-xs font-medium border-none outline-none cursor-pointer w-20\"\r\n                    >\r\n                        <option value=\"Helvetica\">Sans</option>\r\n                        <option value=\"Times\">Serif</option>\r\n                        <option value=\"Courier\">Mono</option>\r\n                    </select>\r\n\r\n                    <div className=\"h-4 w-px bg-white/20\" />\r\n\r\n                    <button onClick={() => updateTextStyle('isBold', !textStyle.isBold)} className={`p-1 rounded hover:bg-black/10 ${textStyle.isBold ? 'bg-white/50 text-primary' : ''}`}><Bold className=\"w-3.5 h-3.5\" /></button>\r\n                    <button onClick={() => updateTextStyle('isItalic', !textStyle.isItalic)} className={`p-1 rounded hover:bg-black/10 ${textStyle.isItalic ? 'bg-white/50 text-primary' : ''}`}><Italic className=\"w-3.5 h-3.5\" /></button>\r\n                    <button onClick={() => updateTextStyle('isUnderline', !textStyle.isUnderline)} className={`p-1 rounded hover:bg-black/10 ${textStyle.isUnderline ? 'bg-white/50 text-primary' : ''}`}><Underline className=\"w-3.5 h-3.5\" /></button>\r\n\r\n                    <div className=\"h-4 w-px bg-white/20\" />\r\n\r\n                    <input\r\n                        type=\"number\"\r\n                        value={textStyle.size}\r\n                        onChange={(e) => updateTextStyle('size', Number(e.target.value))}\r\n                        className=\"w-12 bg-transparent text-xs text-center border-b border-white/20 focus:border-primary outline-none\"\r\n                    />\r\n\r\n                    <div className=\"h-4 w-px bg-white/20\" />\r\n\r\n                    <div className=\"relative group flex items-center\">\r\n                        <input\r\n                            type=\"color\"\r\n                            value={drawColor}\r\n                            onChange={(e) => setDrawColor(e.target.value)}\r\n                            className=\"w-5 h-5 rounded border-none cursor-pointer\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (mode === 'draw' || (mode === 'cursor' && selectedAnnotationType === 'drawing')) {\r\n            return (\r\n                <div className=\"flex items-center gap-4 px-4 py-1 bg-white/40 dark:bg-black/40 backdrop-blur-md rounded-full border border-white/20 animate-in slide-in-from-top-2\">\r\n                    <span className=\"text-xs font-medium text-muted-foreground uppercase\">{mode === 'cursor' ? 'Edit Drawing' : 'Drawing'}</span>\r\n                    <div className=\"h-4 w-px bg-white/20\" />\r\n\r\n                    <div className=\"flex items-center gap-1\">\r\n                        {colors.map(c => (\r\n                            <button\r\n                                key={c}\r\n                                onClick={() => setDrawColor(c)}\r\n                                className={`w-5 h-5 rounded-full border-2 transition-transform hover:scale-110 ${drawColor === c ? 'border-foreground shadow-sm' : 'border-transparent'}`}\r\n                                style={{ backgroundColor: c }}\r\n                            />\r\n                        ))}\r\n                        <input\r\n                            type=\"color\"\r\n                            value={drawColor}\r\n                            onChange={(e) => setDrawColor(e.target.value)}\r\n                            className=\"w-6 h-6 rounded-full border-0 p-0 overflow-hidden cursor-pointer\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"h-4 w-px bg-white/20\" />\r\n\r\n                    <input\r\n                        type=\"range\" min=\"1\" max=\"10\" step=\"1\"\r\n                        value={brushSize}\r\n                        onChange={(e) => setBrushSize(Number(e.target.value))}\r\n                        className=\"w-20 accent-primary h-1.5 bg-muted rounded-lg\"\r\n                    />\r\n                </div>\r\n            );\r\n        }\r\n\r\n        switch (mode) {\r\n            case 'stamp_remover':\r\n                return (\r\n                    <div className=\"flex items-center gap-2 px-4 py-1 bg-purple-500/10 text-purple-600 rounded-full border border-purple-200/50 backdrop-blur-sm animate-in slide-in-from-top-2\">\r\n                        <Wand2 className=\"w-4 h-4\" />\r\n                        <span className=\"text-xs font-bold\">AI Stamp Remover: Click page to clean</span>\r\n                    </div>\r\n                );\r\n            case 'eraser':\r\n                return (\r\n                    <div className=\"flex items-center gap-2 px-4 py-1 bg-red-500/10 text-red-600 rounded-full border border-red-200/50 backdrop-blur-sm animate-in slide-in-from-top-2\">\r\n                        <Eraser className=\"w-4 h-4\" />\r\n                        <span className=\"text-xs font-bold\">Click items to delete</span>\r\n                    </div>\r\n                );\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-16 border-b border-white/20 bg-white/60 dark:bg-black/60 backdrop-blur-xl px-6 flex items-center justify-between shrink-0 z-30 relative\">\r\n\r\n            {/* Left: Status / Tool Info */}\r\n            <div className=\"flex items-center gap-4 flex-1 overflow-x-auto no-scrollbar\">\r\n                {renderToolSpecifics()}\r\n                {status && (\r\n                    <div className=\"flex items-center gap-2 text-xs text-green-600 font-medium px-3 py-1 bg-green-500/10 backdrop-blur-sm border border-green-500/20 rounded-full whitespace-nowrap\">\r\n                        <CheckCircle2 className=\"w-3 h-3\" /> {status}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Right: Actions */}\r\n            <div className=\"flex items-center gap-3 flex-none justify-end ml-4\">\r\n                <button\r\n                    onClick={() => onAction('toggle_ai')}\r\n                    className=\"flex items-center gap-2 px-4 py-2.5 bg-primary/10 text-primary rounded-full text-sm font-bold hover:bg-primary/20 transition-all border border-primary/20\"\r\n                >\r\n                    <Sparkles className=\"w-4 h-4\" />\r\n                    <span className=\"hidden sm:inline\">Ask AI</span>\r\n                </button>\r\n                <button\r\n                    onClick={onExport}\r\n                    className=\"flex items-center gap-2 px-5 py-2.5 bg-foreground text-background rounded-full text-sm font-bold shadow-xl hover:shadow-2xl hover:-translate-y-0.5 transition-all\"\r\n                >\r\n                    <Download className=\"w-4 h-4\" />\r\n                    <span className=\"hidden sm:inline\">Export</span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3072, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/components/ReorderDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X, GripVertical } from 'lucide-react';\r\nimport { Document, Page, pdfjs } from 'react-pdf';\r\nimport { useFileStore } from '@/store/useFileStore';\r\n\r\nif (typeof window !== 'undefined') pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\r\n\r\ninterface ReorderDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    pageCount: number;\r\n    onApply: (newOrder: number[]) => void;\r\n}\r\n\r\nexport const ReorderDialog: React.FC<ReorderDialogProps> = ({ isOpen, onClose, pageCount, onApply }) => {\r\n    const { file } = useFileStore();\r\n    const [pages, setPages] = useState<number[]>([]);\r\n    const [draggedItem, setDraggedItem] = useState<number | null>(null);\r\n\r\n    // Initialize/Reset pages when dialog opens\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setPages(Array.from({ length: pageCount }, (_, i) => i));\r\n        }\r\n    }, [isOpen, pageCount]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const onDragStart = (e: React.DragEvent, index: number) => {\r\n        setDraggedItem(index);\r\n        e.dataTransfer.effectAllowed = \"move\";\r\n        // Optional: Set a custom drag image or styling\r\n        e.dataTransfer.setData('text/plain', index.toString());\r\n    };\r\n\r\n    const onDragOver = (e: React.DragEvent, index: number) => {\r\n        e.preventDefault(); // Necessary to allow dropping\r\n        if (draggedItem === null || draggedItem === index) return;\r\n\r\n        const newPages = [...pages];\r\n        const item = newPages.splice(draggedItem, 1)[0];\r\n        newPages.splice(index, 0, item);\r\n\r\n        setPages(newPages);\r\n        setDraggedItem(index);\r\n    };\r\n\r\n    const onDragEnd = () => {\r\n        setDraggedItem(null);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in\">\r\n            <div className=\"bg-background/95 backdrop-blur-2xl rounded-3xl shadow-2xl max-w-4xl w-full h-[85vh] flex flex-col border border-border overflow-hidden animate-in zoom-in-95\">\r\n\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-border flex justify-between items-center bg-muted/20\">\r\n                    <div>\r\n                        <h3 className=\"font-bold text-xl tracking-tight\">Reorder Pages</h3>\r\n                        <p className=\"text-sm text-muted-foreground\">Drag and drop pages to rearrange the document</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-muted rounded-full transition-colors\">\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Grid Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-6 bg-muted/10\">\r\n                    {file ? (\r\n                        <Document file={file} className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\r\n                            {pages.map((originalIndex, i) => (\r\n                                <div\r\n                                    key={originalIndex} // Important: Use originalIndex as key to maintain DOM identity during reorder if possible, or i if simple\r\n                                    draggable\r\n                                    onDragStart={(e) => onDragStart(e, i)}\r\n                                    onDragOver={(e) => onDragOver(e, i)}\r\n                                    onDragEnd={onDragEnd}\r\n                                    className={`\r\n                                group relative flex flex-col gap-2 p-3 rounded-xl cursor-move transition-all duration-200\r\n                                ${draggedItem === i\r\n                                            ? 'opacity-30 scale-95 bg-primary/20 ring-2 ring-primary border-transparent'\r\n                                            : 'hover:bg-white/50 dark:hover:bg-black/20 border border-transparent hover:border-border hover:shadow-lg'\r\n                                        }\r\n                            `}\r\n                                >\r\n                                    <div className=\"relative rounded-lg overflow-hidden shadow-sm border border-border bg-white pointer-events-none select-none aspect-[1/1.4] flex items-center justify-center\">\r\n                                        <Page\r\n                                            pageNumber={originalIndex + 1}\r\n                                            width={150}\r\n                                            renderTextLayer={false}\r\n                                            renderAnnotationLayer={false}\r\n                                            className=\"max-w-full max-h-full object-contain\"\r\n                                        />\r\n                                        {/* Overlay Number */}\r\n                                        <div className=\"absolute bottom-2 right-2 bg-black/70 text-white text-[10px] font-bold px-2 py-0.5 rounded-full backdrop-blur-md z-10\">\r\n                                            {originalIndex + 1}\r\n                                        </div>\r\n                                        <div className=\"absolute top-2 right-2 text-primary opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <GripVertical className=\"w-5 h-5 drop-shadow-md\" />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"text-center\">\r\n                                        <span className=\"text-xs font-medium text-muted-foreground\">Page {i + 1}</span>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </Document>\r\n                    ) : (\r\n                        <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n                            Loading preview...\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-6 border-t border-border flex justify-end gap-3 bg-muted/20\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-6 py-2.5 rounded-xl border border-border hover:bg-muted font-medium transition-colors text-sm\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={() => onApply(pages)}\r\n                        className=\"px-8 py-2.5 rounded-xl bg-primary text-primary-foreground font-bold shadow-lg shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all text-sm\"\r\n                    >\r\n                        Apply Changes\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;;;AALA;;;;;AAOA,wCAAmC,uPAAK,CAAC,mBAAmB,CAAC,SAAS,GAAG,CAAC,uBAAuB,EAAE,uPAAK,CAAC,OAAO,CAAC,yBAAyB,CAAC;AASpI,MAAM,gBAA8C,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE;;IAC/F,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,+IAAY;IAC7B,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,wRAAQ,EAAW,EAAE;IAC/C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,wRAAQ,EAAgB;IAE9D,2CAA2C;IAC3C,IAAA,yRAAS;mCAAC;YACN,IAAI,QAAQ;gBACR,SAAS,MAAM,IAAI,CAAC;oBAAE,QAAQ;gBAAU;+CAAG,CAAC,GAAG,IAAM;;YACzD;QACJ;kCAAG;QAAC;QAAQ;KAAU;IAEtB,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,cAAc,CAAC,GAAoB;QACrC,eAAe;QACf,EAAE,YAAY,CAAC,aAAa,GAAG;QAC/B,+CAA+C;QAC/C,EAAE,YAAY,CAAC,OAAO,CAAC,cAAc,MAAM,QAAQ;IACvD;IAEA,MAAM,aAAa,CAAC,GAAoB;QACpC,EAAE,cAAc,IAAI,8BAA8B;QAClD,IAAI,gBAAgB,QAAQ,gBAAgB,OAAO;QAEnD,MAAM,WAAW;eAAI;SAAM;QAC3B,MAAM,OAAO,SAAS,MAAM,CAAC,aAAa,EAAE,CAAC,EAAE;QAC/C,SAAS,MAAM,CAAC,OAAO,GAAG;QAE1B,SAAS;QACT,eAAe;IACnB;IAEA,MAAM,YAAY;QACd,eAAe;IACnB;IAEA,qBACI,4SAAC;QAAI,WAAU;kBACX,cAAA,4SAAC;YAAI,WAAU;;8BAGX,4SAAC;oBAAI,WAAU;;sCACX,4SAAC;;8CACG,4SAAC;oCAAG,WAAU;8CAAmC;;;;;;8CACjD,4SAAC;oCAAE,WAAU;8CAAgC;;;;;;;;;;;;sCAEjD,4SAAC;4BAAO,SAAS;4BAAS,WAAU;sCAChC,cAAA,4SAAC,wRAAC;gCAAC,WAAU;;;;;;;;;;;;;;;;;8BAKrB,4SAAC;oBAAI,WAAU;8BACV,qBACG,4SAAC,kTAAQ;wBAAC,MAAM;wBAAM,WAAU;kCAC3B,MAAM,GAAG,CAAC,CAAC,eAAe,kBACvB,4SAAC;gCAEG,SAAS;gCACT,aAAa,CAAC,IAAM,YAAY,GAAG;gCACnC,YAAY,CAAC,IAAM,WAAW,GAAG;gCACjC,WAAW;gCACX,WAAW,CAAC;;gCAEhB,EAAE,gBAAgB,IACJ,6EACA,yGACL;4BACb,CAAC;;kDAEO,4SAAC;wCAAI,WAAU;;0DACX,4SAAC,sSAAI;gDACD,YAAY,gBAAgB;gDAC5B,OAAO;gDACP,iBAAiB;gDACjB,uBAAuB;gDACvB,WAAU;;;;;;0DAGd,4SAAC;gDAAI,WAAU;0DACV,gBAAgB;;;;;;0DAErB,4SAAC;gDAAI,WAAU;0DACX,cAAA,4SAAC,6TAAY;oDAAC,WAAU;;;;;;;;;;;;;;;;;kDAIhC,4SAAC;wCAAI,WAAU;kDACX,cAAA,4SAAC;4CAAK,WAAU;;gDAA4C;gDAAM,IAAI;;;;;;;;;;;;;+BA/BrE;;;;;;;;;iFAqCjB,4SAAC;wBAAI,WAAU;kCAAgE;;;;;;;;;;;8BAOvF,4SAAC;oBAAI,WAAU;;sCACX,4SAAC;4BACG,SAAS;4BACT,WAAU;sCACb;;;;;;sCAGD,4SAAC;4BACG,SAAS,IAAM,QAAQ;4BACvB,WAAU;sCACb;;;;;;;;;;;;;;;;;;;;;;;AAOrB;GAvHa;;QACQ,+IAAY;;;KADpB"}},
    {"offset": {"line": 3338, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/ThinkingSidebar.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { X, Sparkles, Bot, User, ArrowRight, Download } from 'lucide-react';\r\nimport { ChatMessage } from '@/types';\r\n\r\ninterface ThinkingSidebarProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  messages: ChatMessage[];\r\n  isThinking: boolean;\r\n  onSendMessage: (text: string) => void;\r\n}\r\n\r\nexport const ThinkingSidebar: React.FC<ThinkingSidebarProps> = ({ isOpen, onClose, messages, isThinking, onSendMessage }) => {\r\n  const bottomRef = useRef<HTMLDivElement>(null);\r\n  const [inputVal, setInputVal] = useState('');\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages, isThinking]);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (inputVal.trim()) {\r\n      onSendMessage(inputVal);\r\n      setInputVal('');\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed top-0 bottom-0 right-0 w-full md:w-[450px] bg-background/95 backdrop-blur-xl border-l border-border shadow-2xl z-[1000] flex flex-col animate-in slide-in-from-right duration-300\">\r\n      {/* Header */}\r\n      <div className=\"h-16 px-4 border-b border-border flex items-center justify-between bg-background/50 backdrop-blur-md shrink-0\">\r\n        <div className=\"flex items-center gap-2 text-primary font-bold\">\r\n          <Sparkles className=\"w-5 h-5\" />\r\n          <h2>Gemini Assistant</h2>\r\n        </div>\r\n        <button onClick={onClose} className=\"p-2 hover:bg-muted rounded-full transition-colors text-muted-foreground\">\r\n          <X className=\"w-5 h-5\" />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Messages Area - Fixed Flex Growth and Overflow */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-6 bg-muted/10\">\r\n        {messages.length === 0 && (\r\n          <div className=\"h-full flex flex-col items-center justify-center text-muted-foreground text-center p-8 opacity-70\">\r\n            <div className=\"w-16 h-16 bg-primary/5 rounded-full flex items-center justify-center mb-4\">\r\n              <Bot className=\"w-8 h-8 text-primary\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-foreground mb-2\">How can I help?</h3>\r\n            <p className=\"text-sm mb-6\">Ask me to edit content, summarize text, or clean up stamps.</p>\r\n            <div className=\"flex flex-wrap justify-center gap-2\">\r\n              <button onClick={() => onSendMessage(\"Summarize this document\")} className=\"text-xs border px-3 py-1.5 rounded-full hover:bg-primary/5\">Summarize</button>\r\n              <button onClick={() => onSendMessage(\"Suggest edits for this page\")} className=\"text-xs border px-3 py-1.5 rounded-full hover:bg-primary/5\">Suggest Edits</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {messages.map((msg) => (\r\n          <div key={msg.id} className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}>\r\n            <div className={`\r\n                w-8 h-8 rounded-full flex items-center justify-center shrink-0 border\r\n                ${msg.role === 'user' ? 'bg-zinc-100 dark:bg-zinc-800' : 'bg-red-50 dark:bg-red-900/20 text-primary border-red-100'}\r\n            `}>\r\n              {msg.role === 'user' ? <User className=\"w-4 h-4\" /> : <Sparkles className=\"w-4 h-4\" />}\r\n            </div>\r\n            <div className={`\r\n                max-w-[85%] p-3.5 rounded-2xl text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words\r\n                ${msg.role === 'user'\r\n                ? 'bg-white dark:bg-zinc-800 text-foreground rounded-tr-sm border border-border'\r\n                : 'bg-white dark:bg-black/40 text-foreground border border-primary/10 rounded-tl-sm'\r\n              }\r\n            `}>\r\n              {msg.text}\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        {isThinking && (\r\n          <div className=\"flex gap-3 animate-pulse\">\r\n            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0 text-primary\">\r\n              <Sparkles className=\"w-4 h-4\" />\r\n            </div>\r\n            <div className=\"space-y-2 w-full pt-2\">\r\n              <div className=\"h-2 bg-muted rounded w-3/4\"></div>\r\n              <div className=\"h-2 bg-muted rounded w-1/2\"></div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"p-4 border-t border-border bg-background shrink-0\">\r\n        <form onSubmit={handleSubmit} className=\"relative\">\r\n          <input\r\n            type=\"text\"\r\n            value={inputVal}\r\n            onChange={(e) => setInputVal(e.target.value)}\r\n            placeholder=\"Ask Gemini to analyze or edit...\"\r\n            className=\"w-full bg-muted/50 border border-input rounded-xl py-3 pl-4 pr-12 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary\"\r\n          />\r\n          <button\r\n            type=\"submit\"\r\n            disabled={!inputVal.trim() || isThinking}\r\n            className=\"absolute right-2 top-2 p-1.5 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50 transition-colors\"\r\n          >\r\n            <ArrowRight className=\"w-4 h-4\" />\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;;;;;AAWO,MAAM,kBAAkD,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,aAAa,EAAE;;IACtH,MAAM,YAAY,IAAA,sRAAM,EAAiB;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,wRAAQ,EAAC;IAEzC,IAAA,yRAAS;qCAAC;YACR,UAAU,OAAO,EAAE,eAAe;gBAAE,UAAU;YAAS;QACzD;oCAAG;QAAC;QAAU;KAAW;IAEzB,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,SAAS,IAAI,IAAI;YACnB,cAAc;YACd,YAAY;QACd;IACF;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,4SAAC;QAAI,WAAU;;0BAEb,4SAAC;gBAAI,WAAU;;kCACb,4SAAC;wBAAI,WAAU;;0CACb,4SAAC,6SAAQ;gCAAC,WAAU;;;;;;0CACpB,4SAAC;0CAAG;;;;;;;;;;;;kCAEN,4SAAC;wBAAO,SAAS;wBAAS,WAAU;kCAClC,cAAA,4SAAC,wRAAC;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAKjB,4SAAC;gBAAI,WAAU;;oBACZ,SAAS,MAAM,KAAK,mBACnB,4SAAC;wBAAI,WAAU;;0CACb,4SAAC;gCAAI,WAAU;0CACb,cAAA,4SAAC,8RAAG;oCAAC,WAAU;;;;;;;;;;;0CAEjB,4SAAC;gCAAG,WAAU;0CAAqC;;;;;;0CACnD,4SAAC;gCAAE,WAAU;0CAAe;;;;;;0CAC5B,4SAAC;gCAAI,WAAU;;kDACb,4SAAC;wCAAO,SAAS,IAAM,cAAc;wCAA4B,WAAU;kDAA6D;;;;;;kDACxI,4SAAC;wCAAO,SAAS,IAAM,cAAc;wCAAgC,WAAU;kDAA6D;;;;;;;;;;;;;;;;;;oBAKjJ,SAAS,GAAG,CAAC,CAAC,oBACb,4SAAC;4BAAiB,WAAW,CAAC,WAAW,EAAE,IAAI,IAAI,KAAK,SAAS,qBAAqB,IAAI;;8CACxF,4SAAC;oCAAI,WAAW,CAAC;;gBAEb,EAAE,IAAI,IAAI,KAAK,SAAS,iCAAiC,2DAA2D;YACxH,CAAC;8CACE,IAAI,IAAI,KAAK,uBAAS,4SAAC,iSAAI;wCAAC,WAAU;;;;;iGAAe,4SAAC,6SAAQ;wCAAC,WAAU;;;;;;;;;;;8CAE5E,4SAAC;oCAAI,WAAW,CAAC;;gBAEb,EAAE,IAAI,IAAI,KAAK,SACb,iFACA,mFACH;YACH,CAAC;8CACE,IAAI,IAAI;;;;;;;2BAdH,IAAI,EAAE;;;;;oBAmBjB,4BACC,4SAAC;wBAAI,WAAU;;0CACb,4SAAC;gCAAI,WAAU;0CACb,cAAA,4SAAC,6SAAQ;oCAAC,WAAU;;;;;;;;;;;0CAEtB,4SAAC;gCAAI,WAAU;;kDACb,4SAAC;wCAAI,WAAU;;;;;;kDACf,4SAAC;wCAAI,WAAU;;;;;;;;;;;;;;;;;;kCAIrB,4SAAC;wBAAI,KAAK;;;;;;;;;;;;0BAIZ,4SAAC;gBAAI,WAAU;0BACb,cAAA,4SAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACtC,4SAAC;4BACC,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;4BAC3C,aAAY;4BACZ,WAAU;;;;;;sCAEZ,4SAAC;4BACC,MAAK;4BACL,UAAU,CAAC,SAAS,IAAI,MAAM;4BAC9B,WAAU;sCAEV,cAAA,4SAAC,uTAAU;gCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMlC;GAtGa;KAAA"}},
    {"offset": {"line": 3658, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/components/ui/ExportDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X, Download, Lock, FileDown, Sliders, Zap } from 'lucide-react';\r\nimport { useSettingsStore } from '@/store/useSettingsStore';\r\n\r\nexport interface ExportOptions {\r\n    password?: string;\r\n    compression?: number;\r\n}\r\n\r\ninterface ExportDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onExport: (fileName: string, options: ExportOptions) => void;\r\n    defaultFileName: string;\r\n}\r\n\r\nexport const ExportDialog: React.FC<ExportDialogProps> = ({ isOpen, onClose, onExport, defaultFileName }) => {\r\n    const { settings } = useSettingsStore();\r\n    const [fileName, setFileName] = useState(defaultFileName.replace('.pdf', ''));\r\n    const [compression, setCompression] = useState(80);\r\n    const [isEncrypted, setIsEncrypted] = useState(false);\r\n    const [password, setPassword] = useState('');\r\n\r\n    // Apply Auto-Compress setting on open\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            // If autoCompress is on, default to 50% (aggressive) otherwise 80% (high quality)\r\n            setCompression(settings.autoCompress ? 50 : 80);\r\n        }\r\n    }, [isOpen, settings.autoCompress]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-background rounded-2xl shadow-2xl max-w-md w-full overflow-hidden border border-border animate-in zoom-in-95 duration-200\">\r\n\r\n                {/* Header */}\r\n                <div className=\"px-6 py-4 border-b border-border flex justify-between items-center bg-muted/30\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"p-2 bg-primary/10 rounded-lg\">\r\n                            <FileDown className=\"w-5 h-5 text-primary\" />\r\n                        </div>\r\n                        <h3 className=\"font-semibold text-lg\">Export Document</h3>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-1 hover:bg-muted rounded-full transition-colors\">\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-6\">\r\n\r\n                    {/* File Name */}\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-muted-foreground\">File Name</label>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                value={fileName}\r\n                                onChange={(e) => setFileName(e.target.value)}\r\n                                className=\"flex-1 bg-background border border-input rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/20 outline-none\"\r\n                            />\r\n                            <span className=\"text-sm text-muted-foreground font-medium\">.pdf</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Compression Slider */}\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex justify-between text-sm\">\r\n                            <span className=\"font-medium text-muted-foreground flex items-center gap-2\">\r\n                                <Sliders className=\"w-4 h-4\" /> Compression Quality\r\n                                {settings.autoCompress && (\r\n                                    <span className=\"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded-full flex items-center gap-1\">\r\n                                        <Zap className=\"w-3 h-3\" /> Auto\r\n                                    </span>\r\n                                )}\r\n                            </span>\r\n                            <span className=\"text-primary font-mono\">{compression}%</span>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"10\"\r\n                            max=\"100\"\r\n                            value={compression}\r\n                            onChange={(e) => setCompression(Number(e.target.value))}\r\n                            className=\"w-full h-2 bg-muted rounded-lg appearance-none cursor-pointer accent-primary\"\r\n                        />\r\n                        <p className=\"text-[10px] text-muted-foreground\">\r\n                            {compression < 50 ? \"High compression (smaller file, lower quality)\" : \"Balanced compression\"}\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Encryption Toggle */}\r\n                    <div className=\"space-y-3 pt-2 border-t border-border\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"flex items-center gap-2 text-sm font-medium cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={isEncrypted}\r\n                                    onChange={(e) => setIsEncrypted(e.target.checked)}\r\n                                    className=\"rounded border-input text-primary focus:ring-primary\"\r\n                                />\r\n                                <Lock className=\"w-4 h-4 text-muted-foreground\" />\r\n                                Encrypt with Password\r\n                            </label>\r\n                        </div>\r\n\r\n                        {isEncrypted && (\r\n                            <input\r\n                                type=\"password\"\r\n                                value={password}\r\n                                onChange={(e) => setPassword(e.target.value)}\r\n                                placeholder=\"Enter secure password\"\r\n                                className=\"w-full bg-background border border-input rounded-lg px-3 py-2 text-sm animate-in slide-in-from-top-2\"\r\n                            />\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Action Buttons */}\r\n                    <div className=\"flex gap-3 pt-2\">\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"flex-1 px-4 py-2.5 rounded-xl border border-border text-sm font-medium hover:bg-muted transition-colors\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            onClick={() => onExport(fileName + '.pdf', { password: isEncrypted ? password : undefined, compression })}\r\n                            disabled={isEncrypted && !password}\r\n                            className=\"flex-1 px-4 py-2.5 rounded-xl bg-primary text-primary-foreground text-sm font-medium hover:opacity-90 transition-opacity flex items-center justify-center gap-2 shadow-lg shadow-primary/20 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                            <Download className=\"w-4 h-4\" />\r\n                            Export PDF\r\n                        </button>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4014, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/components/ui/SettingsDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from 'react';\r\nimport { X, Moon, Sun, Monitor, Zap, Shield, Lock, Sliders, Check } from 'lucide-react';\r\nimport { useSettingsStore } from '@/store/useSettingsStore';\r\n\r\ninterface SettingsDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const SettingsDialog: React.FC<SettingsDialogProps> = ({ isOpen, onClose }) => {\r\n    const { settings, updateSettings } = useSettingsStore();\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white/95 dark:bg-zinc-900/95 backdrop-blur-2xl rounded-2xl shadow-2xl w-full max-w-lg border border-white/20 dark:border-white/10 overflow-hidden flex flex-col max-h-[85vh] animate-in zoom-in-95 duration-200\">\r\n\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-white/10 shrink-0 bg-gray-50/50 dark:bg-black/20\">\r\n                    <h2 className=\"text-lg font-bold flex items-center gap-2\">\r\n                        <Sliders className=\"w-5 h-5 text-primary\" />\r\n                        Settings & Preferences\r\n                    </h2>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full transition-colors\"\r\n                    >\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Scrollable Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar\">\r\n\r\n                    {/* Section 1: Core Logic & AI */}\r\n                    <section className=\"space-y-4\">\r\n                        <div className=\"flex items-center gap-2 text-primary font-bold text-xs uppercase tracking-wider mb-2\">\r\n                            <Zap className=\"w-4 h-4\" /> Workflow Logic\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-50 dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/5 overflow-hidden\">\r\n                            <label className=\"flex items-center justify-between p-4 cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition-colors border-b border-gray-100 dark:border-white/5 last:border-0\">\r\n                                <div className=\"space-y-0.5\">\r\n                                    <span className=\"text-sm font-semibold block\">Auto-Compress Exports</span>\r\n                                    <span className=\"text-xs text-muted-foreground block\">Automatically optimize PDF size when saving</span>\r\n                                </div>\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={settings.autoCompress}\r\n                                        onChange={(e) => updateSettings({ autoCompress: e.target.checked })}\r\n                                        className=\"peer sr-only\"\r\n                                    />\r\n                                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/20 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary\"></div>\r\n                                </div>\r\n                            </label>\r\n\r\n                            <label className=\"flex items-center justify-between p-4 cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition-colors\">\r\n                                <div className=\"space-y-0.5\">\r\n                                    <span className=\"text-sm font-semibold block\">AI Thinking Process</span>\r\n                                    <span className=\"text-xs text-muted-foreground block\">Show step-by-step reasoning in chat sidebar</span>\r\n                                </div>\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={settings.aiThinking}\r\n                                        onChange={(e) => updateSettings({ aiThinking: e.target.checked })}\r\n                                        className=\"peer sr-only\"\r\n                                    />\r\n                                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/20 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary\"></div>\r\n                                </div>\r\n                            </label>\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* Section 2: Security Defaults */}\r\n                    <section className=\"space-y-4\">\r\n                        <div className=\"flex items-center gap-2 text-primary font-bold text-xs uppercase tracking-wider mb-2\">\r\n                            <Shield className=\"w-4 h-4\" /> Security Defaults\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-50 dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/5 p-4 space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold uppercase text-muted-foreground flex items-center gap-1\">\r\n                                    <Lock className=\"w-3 h-3\" /> Default Password\r\n                                </label>\r\n                                <input\r\n                                    type=\"password\"\r\n                                    value={settings.defaultPassword}\r\n                                    onChange={(e) => updateSettings({ defaultPassword: e.target.value })}\r\n                                    placeholder=\"Enter a password to pre-fill\"\r\n                                    className=\"w-full bg-white dark:bg-black/20 border border-gray-200 dark:border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold uppercase text-muted-foreground\">Default Permissions</label>\r\n                                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\r\n                                    {[\r\n                                        { key: 'printing', label: 'Printing' },\r\n                                        { key: 'copying', label: 'Copying' },\r\n                                        { key: 'modifying', label: 'Modifying' }\r\n                                    ].map((perm) => (\r\n                                        <label key={perm.key} className=\"flex items-center gap-2 p-2 bg-white dark:bg-black/20 rounded-lg border border-gray-200 dark:border-white/10 cursor-pointer hover:border-primary/50 transition-colors\">\r\n                                            <div className={`w-4 h-4 rounded border flex items-center justify-center transition-colors ${settings.permissions[perm.key as keyof typeof settings.permissions] ? 'bg-primary border-primary text-white' : 'border-muted-foreground'}`}>\r\n                                                {settings.permissions[perm.key as keyof typeof settings.permissions] && <Check className=\"w-3 h-3\" />}\r\n                                            </div>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                className=\"hidden\"\r\n                                                checked={!!settings.permissions[perm.key as keyof typeof settings.permissions]}\r\n                                                onChange={(e) => updateSettings({\r\n                                                    permissions: { ...settings.permissions, [perm.key]: e.target.checked }\r\n                                                })}\r\n                                            />\r\n                                            <span className=\"text-xs font-medium\">{perm.label}</span>\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* Section 3: Interface */}\r\n                    <section className=\"space-y-4\">\r\n                        <div className=\"flex items-center gap-2 text-primary font-bold text-xs uppercase tracking-wider mb-2\">\r\n                            <Monitor className=\"w-4 h-4\" /> Interface\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-50 dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/5 p-1 flex\">\r\n                            <button\r\n                                onClick={() => updateSettings({ theme: 'light' })}\r\n                                className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${settings.theme === 'light' ? 'bg-white shadow text-primary' : 'text-muted-foreground hover:bg-black/5'}`}\r\n                            >\r\n                                <Sun className=\"w-4 h-4\" /> Light\r\n                            </button>\r\n                            <button\r\n                                onClick={() => updateSettings({ theme: 'dark' })}\r\n                                className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${settings.theme === 'dark' ? 'bg-zinc-800 shadow text-primary' : 'text-muted-foreground hover:bg-black/5'}`}\r\n                            >\r\n                                <Moon className=\"w-4 h-4\" /> Dark\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-50 dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/5 p-4 flex items-center justify-between\">\r\n                            <span className=\"text-sm font-semibold\">Density</span>\r\n                            <div className=\"flex bg-white dark:bg-black/20 rounded-lg p-1 border border-gray-200 dark:border-white/10\">\r\n                                <button\r\n                                    onClick={() => updateSettings({ density: 'comfortable' })}\r\n                                    className={`px-3 py-1 text-xs rounded-md transition-all ${settings.density === 'comfortable' ? 'bg-primary text-white shadow-sm' : 'text-muted-foreground hover:text-foreground'}`}\r\n                                >\r\n                                    Comfortable\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => updateSettings({ density: 'compact' })}\r\n                                    className={`px-3 py-1 text-xs rounded-md transition-all ${settings.density === 'compact' ? 'bg-primary text-white shadow-sm' : 'text-muted-foreground hover:text-foreground'}`}\r\n                                >\r\n                                    Compact\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </section>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-4 border-t border-gray-200 dark:border-white/10 bg-gray-50/50 dark:bg-black/20 shrink-0 text-center\">\r\n                    <p className=\"text-[10px] text-muted-foreground\">\r\n                        Settings are automatically saved to your browser.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4574, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/editorHelpers.ts"],"sourcesContent":["import { prepareDocumentPrompt } from './geminiService';\r\n\r\nexport const buildFinalPrompt = (\r\n    pdfText: string,\r\n    userQuery: string,\r\n    isFirstMsg: boolean,\r\n    settings: any\r\n) => {\r\n    const prompt = prepareDocumentPrompt(pdfText, userQuery, isFirstMsg);\r\n    return settings.aiThinking\r\n        ? prompt + \"\\n\\n(IMPORTANT: Please Explain your reasoning step-by-step before giving the final answer.)\"\r\n        : prompt + \"\\n\\n(IMPORTANT: Be concise. Do not explain reasoning unless asked.)\";\r\n};\r\n\r\nexport const generateMaskBase64 = async (imageBase64: string, boxes: Array<{ x: number; y: number; w?: number; width?: number; h?: number; height?: number }>) => {\r\n    const img = new Image();\r\n    img.src = imageBase64;\r\n    await img.decode();\r\n\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = img.width;\r\n    canvas.height = img.height;\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) throw new Error('Canvas context not available');\r\n\r\n    // Black background (keep)\r\n    ctx.fillStyle = 'black';\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // White boxes for mask\r\n    ctx.fillStyle = 'white';\r\n    boxes.forEach(b => {\r\n        // support both normalized (0-1) coordinates and absolute pixel coords\r\n        const bx = b.x ?? 0;\r\n        const by = b.y ?? 0;\r\n        const bw = (b.w ?? b.width ?? 0);\r\n        const bh = (b.h ?? b.height ?? 0);\r\n\r\n        let x, y, w, h;\r\n        if (bx > 0 && bx <= 1 && by >= 0 && by <= 1 && bw > 0 && bw <= 1 && bh >= 0 && bh <= 1) {\r\n            x = Math.round(bx * canvas.width);\r\n            y = Math.round(by * canvas.height);\r\n            w = Math.round(bw * canvas.width);\r\n            h = Math.round(bh * canvas.height);\r\n        } else {\r\n            x = Math.round(bx);\r\n            y = Math.round(by);\r\n            w = Math.round(bw);\r\n            h = Math.round(bh);\r\n        }\r\n\r\n        ctx.fillRect(x, y, w, h);\r\n    });\r\n\r\n    return canvas.toDataURL('image/png');\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,mBAAmB,CAC5B,SACA,WACA,YACA;IAEA,MAAM,SAAS,IAAA,4JAAqB,EAAC,SAAS,WAAW;IACzD,OAAO,SAAS,UAAU,GACpB,SAAS,gGACT,SAAS;AACnB;AAEO,MAAM,qBAAqB,OAAO,aAAqB;IAC1D,MAAM,MAAM,IAAI;IAChB,IAAI,GAAG,GAAG;IACV,MAAM,IAAI,MAAM;IAEhB,MAAM,SAAS,SAAS,aAAa,CAAC;IACtC,OAAO,KAAK,GAAG,IAAI,KAAK;IACxB,OAAO,MAAM,GAAG,IAAI,MAAM;IAC1B,MAAM,MAAM,OAAO,UAAU,CAAC;IAC9B,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAE1B,0BAA0B;IAC1B,IAAI,SAAS,GAAG;IAChB,IAAI,QAAQ,CAAC,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;IAE9C,uBAAuB;IACvB,IAAI,SAAS,GAAG;IAChB,MAAM,OAAO,CAAC,CAAA;QACV,sEAAsE;QACtE,MAAM,KAAK,EAAE,CAAC,IAAI;QAClB,MAAM,KAAK,EAAE,CAAC,IAAI;QAClB,MAAM,KAAM,EAAE,CAAC,IAAI,EAAE,KAAK,IAAI;QAC9B,MAAM,KAAM,EAAE,CAAC,IAAI,EAAE,MAAM,IAAI;QAE/B,IAAI,GAAG,GAAG,GAAG;QACb,IAAI,KAAK,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK,KAAK,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM,GAAG;YACpF,IAAI,KAAK,KAAK,CAAC,KAAK,OAAO,KAAK;YAChC,IAAI,KAAK,KAAK,CAAC,KAAK,OAAO,MAAM;YACjC,IAAI,KAAK,KAAK,CAAC,KAAK,OAAO,KAAK;YAChC,IAAI,KAAK,KAAK,CAAC,KAAK,OAAO,MAAM;QACrC,OAAO;YACH,IAAI,KAAK,KAAK,CAAC;YACf,IAAI,KAAK,KAAK,CAAC;YACf,IAAI,KAAK,KAAK,CAAC;YACf,IAAI,KAAK,KAAK,CAAC;QACnB;QAEA,IAAI,QAAQ,CAAC,GAAG,GAAG,GAAG;IAC1B;IAEA,OAAO,OAAO,SAAS,CAAC;AAC5B"}},
    {"offset": {"line": 4629, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/tools/organizeTools.ts"],"sourcesContent":["import { PDFDocument, degrees, rgb, StandardFonts } from 'pdf-lib';\r\nimport { pdfjs } from 'react-pdf';\r\n\r\n// Helper to load PDF\r\nconst load = async (file: File) => await PDFDocument.load(await file.arrayBuffer());\r\n\r\nexport const mergePdfs = async (file1: File, file2: File): Promise<Uint8Array> => {\r\n  const [b1, b2] = await Promise.all([file1.arrayBuffer(), file2.arrayBuffer()]);\r\n  const pdf1 = await PDFDocument.load(b1);\r\n  const pdf2 = await PDFDocument.load(b2);\r\n  const merged = await PDFDocument.create();\r\n  \r\n  (await merged.copyPages(pdf1, pdf1.getPageIndices())).forEach(p => merged.addPage(p));\r\n  (await merged.copyPages(pdf2, pdf2.getPageIndices())).forEach(p => merged.addPage(p));\r\n  \r\n  return await merged.save();\r\n};\r\n\r\nexport const splitPdf = async (file: File, startPage: number, endPage: number): Promise<Uint8Array> => {\r\n  const pdfDoc = await load(file);\r\n  const newPdf = await PDFDocument.create();\r\n  const count = pdfDoc.getPageCount();\r\n  const indices = [];\r\n\r\n  for(let i = startPage - 1; i < endPage; i++) {\r\n    if(i >= 0 && i < count) indices.push(i);\r\n  }\r\n\r\n  (await newPdf.copyPages(pdfDoc, indices)).forEach(p => newPdf.addPage(p));\r\n  return await newPdf.save();\r\n};\r\n\r\nexport const deletePages = async (file: File, pageNumbers: number[]): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const total = pdfDoc.getPageCount();\r\n    // Sort descending to avoid index shifting problems\r\n    const toDelete = pageNumbers.map(p => p - 1).filter(p => p >= 0 && p < total).sort((a, b) => b - a);\r\n    \r\n    toDelete.forEach(idx => pdfDoc.removePage(idx));\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const reorderPages = async (file: File, newOrderIndices: number[]): Promise<Uint8Array> => {\r\n    // newOrderIndices should be 0-based array of old indices\r\n    const pdfDoc = await load(file);\r\n    const newPdf = await PDFDocument.create();\r\n    const copiedPages = await newPdf.copyPages(pdfDoc, newOrderIndices);\r\n    copiedPages.forEach(p => newPdf.addPage(p));\r\n    return await newPdf.save();\r\n};\r\n\r\nexport const rotateSpecificPage = async (file: File, pageNumber: number, angle: number): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const page = pdfDoc.getPage(pageNumber - 1);\r\n    const currentAngle = page.getRotation().angle;\r\n    page.setRotation(degrees(currentAngle + angle));\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const addPageNumbers = async (file: File): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);\r\n    const total = pdfDoc.getPageCount();\r\n\r\n    pdfDoc.getPages().forEach((page, idx) => {\r\n        const { width } = page.getSize();\r\n        page.drawText(`Page ${idx + 1} of ${total}`, {\r\n            x: width / 2 - 30, y: 20, size: 10, font, color: rgb(0,0,0)\r\n        });\r\n    });\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const removeEmptyPages = async (file: File): Promise<{ pdfBytes: Uint8Array | null; removedCount: number }> => {\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjs.getDocument(arrayBuffer).promise;\r\n    const totalPages = pdf.numPages;\r\n    const emptyPageIndices: number[] = []; // 1-based indices for consistency with other tools\r\n\r\n    for (let i = 1; i <= totalPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n        const str = textContent.items.map((item: any) => item.str).join('').trim();\r\n        \r\n        // Basic check: No text\r\n        if (str.length === 0) {\r\n             // Heuristic: Check for drawing operations\r\n             // An absolutely empty page typically has very few operators (save, restore, transform)\r\n             // A scanned image page will have 'paintImageXObject' or similar\r\n             const ops = await page.getOperatorList();\r\n             \r\n             // Threshold: If fewer than 10 drawing commands, assume it's blank.\r\n             // Real content usually has many more.\r\n             if (ops.fnArray.length < 10) {\r\n                emptyPageIndices.push(i);\r\n             }\r\n        }\r\n    }\r\n\r\n    if (emptyPageIndices.length === 0) {\r\n        return { pdfBytes: null, removedCount: 0 };\r\n    }\r\n\r\n    const newPdfBytes = await deletePages(file, emptyPageIndices);\r\n    return { \r\n        pdfBytes: newPdfBytes,\r\n        removedCount: emptyPageIndices.length \r\n    };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4758, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/tools/editTools.ts"],"sourcesContent":["import { PDFDocument, rgb, StandardFonts, degrees } from 'pdf-lib';\r\nimport { Annotation } from '@/types';\r\n\r\nconst load = async (file: File) => await PDFDocument.load(await file.arrayBuffer());\r\n\r\nexport const cropPage = async (file: File, pageIndex: number, rect: { x: number, y: number, w: number, h: number }): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const page = pdfDoc.getPage(pageIndex);\r\n    const { height } = page.getSize();\r\n\r\n    // Convert UI Coords (Top-Left Origin) to PDF Coords (Bottom-Left Origin)\r\n    page.setCropBox(rect.x, height - rect.y - rect.h, rect.w, rect.h);\r\n    page.setMediaBox(rect.x, height - rect.y - rect.h, rect.w, rect.h);\r\n\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const saveAnnotations = async (\r\n    file: File,\r\n    annotations: Annotation[],\r\n    rotations?: Record<number, number>\r\n): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const pages = pdfDoc.getPages();\r\n\r\n    // Embed Fonts\r\n    const helvetica = await pdfDoc.embedFont(StandardFonts.Helvetica);\r\n    const helveticaBold = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\r\n    const helveticaOblique = await pdfDoc.embedFont(StandardFonts.HelveticaOblique);\r\n    const helveticaBoldOblique = await pdfDoc.embedFont(StandardFonts.HelveticaBoldOblique);\r\n\r\n    const times = await pdfDoc.embedFont(StandardFonts.TimesRoman);\r\n    const timesBold = await pdfDoc.embedFont(StandardFonts.TimesRomanBold);\r\n    const timesItalic = await pdfDoc.embedFont(StandardFonts.TimesRomanItalic);\r\n    const timesBoldItalic = await pdfDoc.embedFont(StandardFonts.TimesRomanBoldItalic);\r\n\r\n    const courier = await pdfDoc.embedFont(StandardFonts.Courier);\r\n\r\n    const getFont = (family: string | undefined, bold: boolean | undefined, italic: boolean | undefined) => {\r\n        if (family === 'Times') {\r\n            if (bold && italic) return timesBoldItalic;\r\n            if (bold) return timesBold;\r\n            if (italic) return timesItalic;\r\n            return times;\r\n        }\r\n        if (family === 'Courier') return courier;\r\n        // Default Helvetica\r\n        if (bold && italic) return helveticaBoldOblique;\r\n        if (bold) return helveticaBold;\r\n        if (italic) return helveticaOblique;\r\n        return helvetica;\r\n    };\r\n\r\n    // Apply Rotations (Only rotates the page view, keeps content relative)\r\n    if (rotations) {\r\n        Object.entries(rotations).forEach(([idx, angle]) => {\r\n            const i = parseInt(idx) - 1;\r\n            if (pages[i]) pages[i].setRotation(degrees(pages[i].getRotation().angle + angle));\r\n        });\r\n    }\r\n\r\n    // Apply Annotations\r\n    for (const ann of annotations) {\r\n        const pageIndex = ann.page - 1;\r\n        if (!pages[pageIndex]) continue;\r\n        const page = pages[pageIndex];\r\n        const { height } = page.getSize();\r\n\r\n        if (ann.type === 'text') {\r\n            const r = parseInt(ann.color?.slice(1, 3) || '00', 16) / 255;\r\n            const g = parseInt(ann.color?.slice(3, 5) || '00', 16) / 255;\r\n            const b = parseInt(ann.color?.slice(5, 7) || '00', 16) / 255;\r\n\r\n            const fontToUse = getFont(ann.fontFamily, ann.isBold, ann.isItalic);\r\n\r\n            page.drawText(ann.text, {\r\n                x: ann.x,\r\n                y: height - ann.y - (ann.size || 14),\r\n                size: ann.size || 14,\r\n                font: fontToUse,\r\n                color: rgb(r, g, b)\r\n            });\r\n\r\n            if (ann.isUnderline) {\r\n                const width = fontToUse.widthOfTextAtSize(ann.text, ann.size || 14);\r\n                page.drawLine({\r\n                    start: { x: ann.x, y: height - ann.y - (ann.size || 14) - 2 },\r\n                    end: { x: ann.x + width, y: height - ann.y - (ann.size || 14) - 2 },\r\n                    thickness: 1,\r\n                    color: rgb(r, g, b)\r\n                });\r\n            }\r\n\r\n        } else if (ann.type === 'whiteout' || ann.type === 'redact') {\r\n            const color = ann.type === 'redact' ? rgb(0, 0, 0) : rgb(1, 1, 1);\r\n            page.drawRectangle({ x: ann.x, y: height - ann.y - ann.height, width: ann.width, height: ann.height, color });\r\n\r\n        } else if (ann.type === 'image') {\r\n            const img = ann.dataUrl.startsWith('data:image/png')\r\n                ? await pdfDoc.embedPng(ann.dataUrl)\r\n                : await pdfDoc.embedJpg(ann.dataUrl);\r\n            page.drawImage(img, { x: ann.x, y: height - ann.y - ann.height, width: ann.width, height: ann.height });\r\n\r\n        } else if (ann.type === 'drawing' || ann.type === 'signature') {\r\n            const p = ann.points;\r\n            const r = parseInt(ann.color?.slice(1, 3) || '00', 16) / 255;\r\n            const g = parseInt(ann.color?.slice(3, 5) || '00', 16) / 255;\r\n            const b = parseInt(ann.color?.slice(5, 7) || '00', 16) / 255;\r\n\r\n            for (let i = 0; i < p.length - 1; i++) {\r\n                page.drawLine({\r\n                    start: { x: p[i].x, y: height - p[i].y },\r\n                    end: { x: p[i + 1].x, y: height - p[i + 1].y },\r\n                    thickness: ann.thickness,\r\n                    color: rgb(r, g, b)\r\n                });\r\n            }\r\n        }\r\n    }\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const addWatermark = async (file: File, text: string, colorHex: string = '#000000'): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\r\n\r\n    const r = parseInt(colorHex.slice(1, 3), 16) / 255;\r\n    const g = parseInt(colorHex.slice(3, 5), 16) / 255;\r\n    const b = parseInt(colorHex.slice(5, 7), 16) / 255;\r\n\r\n    pdfDoc.getPages().forEach(page => {\r\n        const { width, height } = page.getSize();\r\n        const fontSize = 60;\r\n        const textWidth = font.widthOfTextAtSize(text, fontSize);\r\n        const textHeight = fontSize; // Approx height\r\n\r\n        // Calculate position to center the rotated text\r\n        const angle = 45;\r\n        const rad = angle * Math.PI / 180;\r\n\r\n        // Offset from rotation origin to text visual center\r\n        const cx = textWidth / 2;\r\n        const cy = textHeight / 3; // Approximate baseline offset\r\n\r\n        // Rotate offset\r\n        const rcx = cx * Math.cos(rad) - cy * Math.sin(rad);\r\n        const rcy = cx * Math.sin(rad) + cy * Math.cos(rad);\r\n\r\n        // Center on page\r\n        const x = width / 2 - rcx;\r\n        const y = height / 2 - rcy;\r\n\r\n        page.drawText(text, {\r\n            x: x,\r\n            y: y,\r\n            size: fontSize,\r\n            font: font,\r\n            color: rgb(r, g, b),\r\n            rotate: degrees(angle),\r\n            opacity: 0.3,\r\n        });\r\n    });\r\n    return await pdfDoc.save();\r\n};\r\n\r\n// NEW: Replace entire page with an image (e.g. after Inpainting)\r\nexport const replacePageWithImage = async (file: File, pageIndex: number, imageBase64: string): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    const page = pdfDoc.getPage(pageIndex);\r\n    const { width, height } = page.getSize();\r\n\r\n    const img = imageBase64.startsWith('data:image/png')\r\n        ? await pdfDoc.embedPng(imageBase64)\r\n        : await pdfDoc.embedJpg(imageBase64);\r\n\r\n    // Draw image over the entire page\r\n    page.drawImage(img, {\r\n        x: 0,\r\n        y: 0,\r\n        width: width,\r\n        height: height\r\n    });\r\n\r\n    return await pdfDoc.save();\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4947, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/services/tools/securityTools.ts"],"sourcesContent":["import { PDFDocument } from 'pdf-lib';\r\n\r\nconst load = async (file: File) => await PDFDocument.load(await file.arrayBuffer());\r\n\r\nexport const encryptPdf = async (\r\n    file: File,\r\n    password: string,\r\n    permissions: { printing: boolean, copying: boolean, modifying: boolean } = { printing: true, copying: false, modifying: false }\r\n): Promise<Uint8Array> => {\r\n    // Load source\r\n    const srcDoc = await load(file);\r\n\r\n    // Create destination (fresh doc always has encrypt method)\r\n    const dstDoc = await PDFDocument.create();\r\n\r\n    // Copy all pages\r\n    const indices = srcDoc.getPageIndices();\r\n    const copiedPages = await dstDoc.copyPages(srcDoc, indices);\r\n    copiedPages.forEach(page => dstDoc.addPage(page));\r\n\r\n    // Construct permissions object\r\n    const permObj: any = {\r\n        modifying: !!permissions.modifying,\r\n        copying: !!permissions.copying,\r\n        annotating: !!permissions.modifying,\r\n        fillingForms: !!permissions.modifying,\r\n        contentAccessibility: !!permissions.copying,\r\n        documentAssembly: !!permissions.modifying,\r\n    };\r\n\r\n    if (permissions.printing) {\r\n        permObj.printing = 'highResolution';\r\n    }\r\n\r\n    // Encrypt the fresh document\r\n    (dstDoc as any).encrypt({\r\n        userPassword: password,\r\n        ownerPassword: password,\r\n        permissions: permObj\r\n    });\r\n\r\n    return await dstDoc.save();\r\n};\r\n\r\nexport const flattenPdf = async (file: File): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    try { pdfDoc.getForm().flatten(); } catch (e) { /* ignore */ }\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const updateMetadata = async (file: File, meta: { title?: string, author?: string }): Promise<Uint8Array> => {\r\n    const pdfDoc = await load(file);\r\n    if (meta.title) pdfDoc.setTitle(meta.title);\r\n    if (meta.author) pdfDoc.setAuthor(meta.author);\r\n    return await pdfDoc.save();\r\n};\r\n\r\nexport const checkEncryption = async (file: File): Promise<boolean> => {\r\n    try {\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        const { pdfjs } = await import('react-pdf');\r\n        // Try loading without password\r\n        await pdfjs.getDocument(arrayBuffer).promise;\r\n        return false;\r\n    } catch (error: any) {\r\n        if (error.name === 'PasswordException' || error.password) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n};\r\n\r\nexport const decryptPdf = async (file: File, password: string): Promise<File> => {\r\n    try {\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        // Load with password\r\n        const pdfDoc = await PDFDocument.load(arrayBuffer, { password } as any);\r\n        // Save without any encryption settings (removes it)\r\n        const decryptedBytes = await pdfDoc.save();\r\n\r\n        return new File(\r\n            [decryptedBytes],\r\n            file.name.replace('.pdf', '_decrypted.pdf'),\r\n            { type: 'application/pdf' }\r\n        );\r\n    } catch (e) {\r\n        throw new Error(\"Invalid Password or Decryption Failed\");\r\n    }\r\n};"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,OAAO,OAAO,OAAe,MAAM,0NAAW,CAAC,IAAI,CAAC,MAAM,KAAK,WAAW;AAEzE,MAAM,aAAa,OACtB,MACA,UACA,cAA2E;IAAE,UAAU;IAAM,SAAS;IAAO,WAAW;AAAM,CAAC;IAE/H,cAAc;IACd,MAAM,SAAS,MAAM,KAAK;IAE1B,2DAA2D;IAC3D,MAAM,SAAS,MAAM,0NAAW,CAAC,MAAM;IAEvC,iBAAiB;IACjB,MAAM,UAAU,OAAO,cAAc;IACrC,MAAM,cAAc,MAAM,OAAO,SAAS,CAAC,QAAQ;IACnD,YAAY,OAAO,CAAC,CAAA,OAAQ,OAAO,OAAO,CAAC;IAE3C,+BAA+B;IAC/B,MAAM,UAAe;QACjB,WAAW,CAAC,CAAC,YAAY,SAAS;QAClC,SAAS,CAAC,CAAC,YAAY,OAAO;QAC9B,YAAY,CAAC,CAAC,YAAY,SAAS;QACnC,cAAc,CAAC,CAAC,YAAY,SAAS;QACrC,sBAAsB,CAAC,CAAC,YAAY,OAAO;QAC3C,kBAAkB,CAAC,CAAC,YAAY,SAAS;IAC7C;IAEA,IAAI,YAAY,QAAQ,EAAE;QACtB,QAAQ,QAAQ,GAAG;IACvB;IAEA,6BAA6B;IAC5B,OAAe,OAAO,CAAC;QACpB,cAAc;QACd,eAAe;QACf,aAAa;IACjB;IAEA,OAAO,MAAM,OAAO,IAAI;AAC5B;AAEO,MAAM,aAAa,OAAO;IAC7B,MAAM,SAAS,MAAM,KAAK;IAC1B,IAAI;QAAE,OAAO,OAAO,GAAG,OAAO;IAAI,EAAE,OAAO,GAAG,CAAe;IAC7D,OAAO,MAAM,OAAO,IAAI;AAC5B;AAEO,MAAM,iBAAiB,OAAO,MAAY;IAC7C,MAAM,SAAS,MAAM,KAAK;IAC1B,IAAI,KAAK,KAAK,EAAE,OAAO,QAAQ,CAAC,KAAK,KAAK;IAC1C,IAAI,KAAK,MAAM,EAAE,OAAO,SAAS,CAAC,KAAK,MAAM;IAC7C,OAAO,MAAM,OAAO,IAAI;AAC5B;AAEO,MAAM,kBAAkB,OAAO;IAClC,IAAI;QACA,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,MAAM,EAAE,KAAK,EAAE,GAAG;QAClB,+BAA+B;QAC/B,MAAM,MAAM,WAAW,CAAC,aAAa,OAAO;QAC5C,OAAO;IACX,EAAE,OAAO,OAAY;QACjB,IAAI,MAAM,IAAI,KAAK,uBAAuB,MAAM,QAAQ,EAAE;YACtD,OAAO;QACX;QACA,OAAO;IACX;AACJ;AAEO,MAAM,aAAa,OAAO,MAAY;IACzC,IAAI;QACA,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,qBAAqB;QACrB,MAAM,SAAS,MAAM,0NAAW,CAAC,IAAI,CAAC,aAAa;YAAE;QAAS;QAC9D,oDAAoD;QACpD,MAAM,iBAAiB,MAAM,OAAO,IAAI;QAExC,OAAO,IAAI,KACP;YAAC;SAAe,EAChB,KAAK,IAAI,CAAC,OAAO,CAAC,QAAQ,mBAC1B;YAAE,MAAM;QAAkB;IAElC,EAAE,OAAO,GAAG;QACR,MAAM,IAAI,MAAM;IACpB;AACJ"}},
    {"offset": {"line": 5048, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code/Extra-PDF/src/features/editor/EditorPage.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { PDFCanvas } from './PDFCanvas';\r\nimport { useFileStore } from '@/store/useFileStore';\r\nimport { useSettingsStore } from '@/store/useSettingsStore';\r\nimport { EditorSidebar } from './components/EditorSidebar';\r\nimport { ThumbnailSidebar } from './components/ThumbnailSidebar';\r\nimport { EditorToolbar } from './components/EditorToolbar';\r\nimport { ReorderDialog } from './components/ReorderDialog';\r\nimport { ThinkingSidebar } from './ThinkingSidebar';\r\nimport { ExportDialog, ExportOptions } from '@/components/ui/ExportDialog';\r\nimport { SettingsDialog } from '@/components/ui/SettingsDialog';\r\nimport { EditorMode, Tool, ToolCategory, ModalState, ChatMessage } from '@/types';\r\nimport { ChevronLeft, Menu, Settings2, Scissors, PanelLeftClose, PanelLeftOpen, Stamp, Lock, Sparkles, Loader2, Bot } from 'lucide-react';\r\nimport { createChatSession, detectStamps, streamResponse, prepareDocumentPrompt, removeStampWithMask } from '@/services/geminiService';\r\nimport { buildFinalPrompt, generateMaskBase64 } from '@/services/editorHelpers';\r\n\r\n\r\n// Import Modular Tools\r\nimport * as Organize from '@/services/tools/organizeTools';\r\nimport * as Edit from '@/services/tools/editTools';\r\nimport * as Security from '@/services/tools/securityTools';\r\nimport * as Convert from '@/services/tools/convertTools';\r\n\r\nexport const EditorPage: React.FC = () => {\r\n    const router = useRouter();\r\n    const { file, replaceFile, addAnnotation, annotations, updateAnnotation, rotatePage, pdfText, numPages, pageRotations, removeAnnotation, editableBlocks, isRestoring } = useFileStore();\r\n\r\n    const { settings } = useSettingsStore();\r\n\r\n    // View State\r\n    const [zoom, setZoom] = useState(1);\r\n    const [mode, setMode] = useState<EditorMode>('cursor');\r\n    const [activeCategory, setActiveCategory] = useState<ToolCategory>('edit');\r\n    const [statusMsg, setStatusMsg] = useState('');\r\n    const [activePage, setActivePage] = useState(1);\r\n\r\n    // UI State\r\n    const [isSidebarOpen, setSidebarOpen] = useState(false);\r\n    const [isThumbnailsOpen, setThumbnailsOpen] = useState(true);\r\n    const [isThinkingOpen, setIsThinkingOpen] = useState(false);\r\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\r\n    const [isAIProcessing, setIsAIProcessing] = useState(false); // NEW: Global AI Loading State\r\n\r\n    // Selection State\r\n    const [selectedAnnId, setSelectedAnnId] = useState<string | null>(null);\r\n    const selectedAnnotation = annotations.find(a => a.id === selectedAnnId);\r\n\r\n    // Chat State\r\n    const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);\r\n    const [isThinking, setIsThinking] = useState(false);\r\n    const chatSessionRef = useRef<any>(null);\r\n    const isFirstMsgRef = useRef(true);\r\n\r\n    // Draw/Text State\r\n    const [drawColor, setDrawColor] = useState('#000000');\r\n    const [brushSize, setBrushSize] = useState(2);\r\n    const [textStyle, setTextStyle] = useState<{\r\n        fontFamily: 'Helvetica' | 'Times' | 'Courier';\r\n        isBold: boolean;\r\n        isItalic: boolean;\r\n        isUnderline: boolean;\r\n        align: 'left' | 'center' | 'right';\r\n        size: number;\r\n    }>({\r\n        fontFamily: 'Helvetica',\r\n        isBold: false,\r\n        isItalic: false,\r\n        isUnderline: false,\r\n        align: 'left',\r\n        size: 14\r\n    });\r\n\r\n    // Modal State\r\n    const [modal, setModal] = useState<ModalState>({ type: null, isOpen: false });\r\n    const [isExportOpen, setIsExportOpen] = useState(false);\r\n    const [mInput1, setMInput1] = useState('');\r\n    const [mInput2, setMInput2] = useState('');\r\n    const [htmlInput, setHtmlInput] = useState('');\r\n\r\n    // Refs\r\n    const mergeInputRef = useRef<HTMLInputElement>(null);\r\n    const imageInputRef = useRef<HTMLInputElement>(null);\r\n    const wordInputRef = useRef<HTMLInputElement>(null);\r\n    const [pendingImage, setPendingImage] = useState<string | null>(null);\r\n    const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (!isRestoring && !file) {\r\n            router.push('/');\r\n        }\r\n    }, [isRestoring, file, router]);\r\n\r\n    useEffect(() => {\r\n        const isDesktop = window.innerWidth >= 768;\r\n        if (isDesktop) setSidebarOpen(true);\r\n        else setThumbnailsOpen(false);\r\n\r\n        chatSessionRef.current = createChatSession();\r\n\r\n        // Restore\r\n        (async () => {\r\n            // restoreState is now idempotent and handles isRestoring\r\n            if (useFileStore.getState().isRestoring) {\r\n                await useFileStore.getState().restoreState();\r\n            }\r\n        })();\r\n    }, []);\r\n\r\n    // Persist file state when annotations/blocks change (debounced)\r\n    useEffect(() => {\r\n        const timeout = setTimeout(() => {\r\n            (async () => {\r\n                try { await (await import('../../store/useFileStore')).useFileStore.getState().persistState(); } catch (e) { }\r\n            })();\r\n        }, 700);\r\n        return () => clearTimeout(timeout);\r\n    }, [annotations, editableBlocks, pageRotations, pdfText]);\r\n\r\n    useEffect(() => {\r\n        if (modal.type === 'encrypt' && settings.defaultPassword) {\r\n            setMInput1(settings.defaultPassword);\r\n        }\r\n    }, [modal.type, settings.defaultPassword]);\r\n\r\n    /* --- Chat & AI Implementation --- */\r\n\r\n    const handleChatSendMessage = async (text: string) => {\r\n        if (!chatSessionRef.current) return;\r\n\r\n        setIsThinking(true);\r\n        const userMsgId = Date.now().toString();\r\n\r\n        // Optimistic UI update\r\n        setChatMessages(prev => [...prev, { id: userMsgId, role: 'user', text }]);\r\n\r\n        const finalPrompt = buildFinalPrompt(pdfText, text, isFirstMsgRef.current, settings);\r\n        isFirstMsgRef.current = false;\r\n\r\n        // Placeholder for model response\r\n        const modelMsgId = (Date.now() + 1).toString();\r\n        setChatMessages(prev => [...prev, { id: modelMsgId, role: 'model', text: '' }]);\r\n\r\n        await streamResponse(\r\n            chatSessionRef.current,\r\n            finalPrompt,\r\n            (chunk) => {\r\n                setChatMessages(prev => prev.map(m =>\r\n                    m.id === modelMsgId ? { ...m, text: m.text + chunk } : m\r\n                ));\r\n            },\r\n            async (toolCall) => {\r\n                // Intercept tool calls from Gemini\r\n                return await handleAIToolExecution(toolCall);\r\n            }\r\n        );\r\n\r\n        setIsThinking(false);\r\n    };\r\n\r\n    const handleAIToolExecution = async (toolCall: any) => {\r\n        const { name, args } = toolCall;\r\n        console.log(`[AI Tool] Executing ${name}`, args);\r\n\r\n        try {\r\n            switch (name) {\r\n                case 'edit_pdf_add_text':\r\n                    addAnnotation({\r\n                        id: Date.now().toString(),\r\n                        page: args.page,\r\n                        type: 'text',\r\n                        x: args.x || 100,\r\n                        y: args.y || 100,\r\n                        text: args.text,\r\n                        color: args.color || '#000000',\r\n                        size: args.fontSize || 14\r\n                    });\r\n                    return \"Text added successfully.\";\r\n\r\n                case 'clean_page_image':\r\n                    // Trigger the visual stamp removal process\r\n                    // Default to page center if no interaction? AI auto-detect\r\n                    await handleStampRemove(args.page);\r\n                    return \"Stamp removal process completed.\";\r\n\r\n                case 'organize_rotate_page':\r\n                    rotatePage(args.page);\r\n                    return `Page ${args.page} rotated.`;\r\n\r\n                case 'organize_delete_page':\r\n                    if (args.pages && args.pages.length > 0) {\r\n                        // We need to actually replace the file, which is async\r\n                        setIsAIProcessing(true);\r\n                        const newBytes = await Organize.deletePages(file!, args.pages);\r\n                        replaceFile(newBytes);\r\n                        setIsAIProcessing(false);\r\n                        return `Pages ${args.pages.join(', ')} deleted.`;\r\n                    }\r\n                    return \"No pages specified.\";\r\n\r\n                case 'get_page_count':\r\n                    return `The document has ${numPages} pages.`;\r\n\r\n                default:\r\n                    return \"Tool not implemented.\";\r\n            }\r\n        } catch (e) {\r\n            console.error(\"AI Tool Execution Error\", e);\r\n            setIsAIProcessing(false);\r\n            return \"Error executing tool.\";\r\n        }\r\n    };\r\n\r\n    /* --- Editor Handlers --- */\r\n\r\n    const handleToolSelect = (tool: Tool) => {\r\n        if (['cursor', 'text', 'edit_text', 'draw', 'whiteout', 'eraser', 'stamp_remover', 'crop', 'redact', 'sign'].includes(tool.id)) {\r\n            setMode(tool.id as EditorMode);\r\n            if (tool.id !== 'cursor') setSelectedAnnId(null);\r\n            if (window.innerWidth < 768) setSidebarOpen(false);\r\n            return;\r\n        }\r\n        if (tool.requiresModal) {\r\n            setMInput1(''); setMInput2(''); setHtmlInput('');\r\n            setModal({ type: tool.id as any, isOpen: true });\r\n            if (window.innerWidth < 768) setSidebarOpen(false);\r\n            return;\r\n        }\r\n        executeDirectAction(tool.id);\r\n        if (window.innerWidth < 768) setSidebarOpen(false);\r\n    };\r\n\r\n    const executeDirectAction = async (id: string) => {\r\n        try {\r\n            if (!file) return;\r\n            switch (id) {\r\n                case 'rotate':\r\n                    rotatePage(activePage);\r\n                    setStatusMsg(`Page ${activePage} Rotated `);\r\n                    break;\r\n                case 'merge': mergeInputRef.current?.click(); break;\r\n                case 'add_image': imageInputRef.current?.click(); break;\r\n                case 'word_to_pdf': wordInputRef.current?.click(); break;\r\n                case 'remove_empty':\r\n                    setStatusMsg(\"Scanning for blank pages... \");\r\n                    const { pdfBytes, removedCount } = await Organize.removeEmptyPages(file);\r\n                    if (pdfBytes && removedCount > 0) {\r\n                        replaceFile(pdfBytes);\r\n                        setStatusMsg(`Removed ${removedCount} empty pages `);\r\n                    } else {\r\n                        setStatusMsg(\"No empty pages found \");\r\n                    }\r\n                    break;\r\n                case 'flatten':\r\n                    replaceFile(await Security.flattenPdf(file), 'flattened.pdf');\r\n                    setStatusMsg(\"PDF Flattened \"); break;\r\n                case 'repair':\r\n                    setStatusMsg(\"Repairing... \");\r\n                    replaceFile(await Convert.repairPdf(file), 'repaired.pdf');\r\n                    setStatusMsg(\"PDF Repaired \"); break;\r\n                case 'page_numbers':\r\n                    replaceFile(await Organize.addPageNumbers(file), 'numbered.pdf');\r\n                    setStatusMsg(\"Added Numbers \"); break;\r\n                case 'pdf_to_word':\r\n                    download(await Convert.createDocxFromText(pdfText), 'converted.docx'); break;\r\n                case 'pdf_to_excel':\r\n                    setStatusMsg(\"Extracting Tables... \");\r\n                    download(await Convert.createXlsxFromPdf(file), 'tables.xlsx'); break;\r\n                case 'pdf_to_ppt':\r\n                    setStatusMsg(\"Creating Slides... \");\r\n                    download(await Convert.createPptxFromPdf(file), 'presentation.pptx'); break;\r\n                case 'ocr_pdf':\r\n                    setStatusMsg(\"Scanning... \");\r\n                    const text = await Convert.ocrPdf(file);\r\n                    download(new Blob([text], { type: 'text/plain' }), 'extracted_text.txt'); break;\r\n                case 'pdf_to_jpg':\r\n                    setStatusMsg(\"Converting... \");\r\n                    const imgs = await Convert.pdfToImages(file);\r\n                    if (imgs.length > 0) {\r\n                        const a = document.createElement('a');\r\n                        a.href = imgs[0]; a.download = `page_1.jpg`; a.click();\r\n                        setStatusMsg('Saved JPG ');\r\n                    } break;\r\n            }\r\n        } catch (e) { console.error(e); alert('Action Failed: ' + (e as Error).message); }\r\n    };\r\n\r\n    const handleAnnotationSelect = (ann: any | null) => {\r\n        setSelectedAnnId(ann ? ann.id : null);\r\n        if (ann) {\r\n            if (ann.type === 'text') {\r\n                setTextStyle({\r\n                    fontFamily: ann.fontFamily || 'Helvetica',\r\n                    isBold: !!ann.isBold, isItalic: !!ann.isItalic, isUnderline: !!ann.isUnderline,\r\n                    align: ann.align || 'left', size: ann.size || 14\r\n                });\r\n                setDrawColor(ann.color || '#000000');\r\n            } else if (ann.type === 'drawing') {\r\n                setDrawColor(ann.color || '#000000');\r\n                setBrushSize(ann.thickness || 2);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleTextStyleChange = (updater: any) => {\r\n        setTextStyle((prev: any) => {\r\n            const newState = typeof updater === 'function' ? updater(prev) : updater;\r\n            if (mode === 'cursor' && selectedAnnId && selectedAnnotation?.type === 'text') {\r\n                updateAnnotation(selectedAnnId, newState);\r\n            }\r\n            return newState;\r\n        });\r\n    };\r\n\r\n    const handlePageClick = (pageNum: number) => {\r\n        setActivePage(pageNum);\r\n        const el = document.getElementById(`page-wrapper-${pageNum}`);\r\n        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n    };\r\n\r\n    // REAL AI STAMP REMOVAL (INPAINTING)\r\n    const handleStampRemove = async (pageNum: number, rect?: { x: number, y: number, w: number, h: number }) => {\r\n        if (!file) return;\r\n\r\n        setIsAIProcessing(true);\r\n        setStatusMsg(rect ? \"AI Inpainting: Removing area...\" : \"AI Vision: Auto-detecting artifacts...\");\r\n\r\n        try {\r\n            // 1. Get Page Image (High Res)\r\n            const imgBase64 = await Convert.getPageImage(file, pageNum);\r\n\r\n            let boxes: any[] = [];\r\n\r\n            // 2. Logic: If rect provided (manual drag), use it. Else auto-detect.\r\n            if (rect) {\r\n                // Convert PDF point coords (595 width) to 0-1 normalized for mask generation logic later if needed\r\n                // But our helper 'createMask' below needs pixel matching.\r\n                // Convert.getPageImage uses scale 1.5 (~892px width).\r\n                // We need to map 'rect' (PDF points) to Image Pixels.\r\n                const pdfWidth = 595;\r\n                const scale = 1.5; // From Convert.getPageImage logic\r\n\r\n                boxes = [{\r\n                    x: Math.floor(rect.x * scale),\r\n                    y: Math.floor(rect.y * scale),\r\n                    w: Math.floor(rect.w * scale),\r\n                    h: Math.floor(rect.h * scale)\r\n                }];\r\n            } else {\r\n                // Auto-detect using Vision (Old Logic)\r\n                const autoBoxes = await detectStamps(imgBase64);\r\n                if (autoBoxes.length === 0) {\r\n                    setIsAIProcessing(false);\r\n                    setStatusMsg(\"AI: No stamps detected.\");\r\n                    return;\r\n                }\r\n                // Map normalized 0-1 to pixels\r\n                const imgObj = new Image();\r\n                imgObj.src = imgBase64;\r\n                await imgObj.decode();\r\n                boxes = autoBoxes.map(b => ({\r\n                    x: Math.floor(b.x * imgObj.width),\r\n                    y: Math.floor(b.y * imgObj.height),\r\n                    w: Math.floor(b.width * imgObj.width),\r\n                    h: Math.floor(b.height * imgObj.height)\r\n                }));\r\n            }\r\n\r\n            // 3. Generate Mask (centralized helper supports pixel or normalized boxes)\r\n            const maskBase64 = await generateMaskBase64(imgBase64, boxes);\r\n\r\n            // 4. Call Gemini Inpainting\r\n            const cleanedImage = await removeStampWithMask(imgBase64, maskBase64);\r\n\r\n            if (!cleanedImage) throw new Error(\"AI returned no image\");\r\n\r\n            // 5. Replace PDF Page\r\n            const newPdfBytes = await Edit.replacePageWithImage(file, pageNum - 1, cleanedImage);\r\n            replaceFile(newPdfBytes, \"cleaned.pdf\");\r\n\r\n            setIsAIProcessing(false);\r\n            setStatusMsg(\"Cleaned Page Replaced \");\r\n            setMode('cursor');\r\n\r\n        } catch (e) {\r\n            console.error(\"Stamp Removal Error\", e);\r\n            setIsAIProcessing(false);\r\n            setStatusMsg(\"AI Error: Removal Failed.\");\r\n        }\r\n    };\r\n\r\n    const handleCropApply = async (pageNum: number, rect: { x: number, y: number, w: number, h: number }) => {\r\n        try {\r\n            if (!file) return;\r\n            setStatusMsg(\"Cropping... \");\r\n            const newBytes = await Edit.cropPage(file, pageNum - 1, rect);\r\n            replaceFile(newBytes, 'cropped.pdf');\r\n            setStatusMsg(\"Cropped! \");\r\n            setMode('cursor');\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Crop failed: \" + (e as Error).message);\r\n        }\r\n    };\r\n\r\n    const handleModalSubmit = async () => {\r\n        try {\r\n            if (!file) return;\r\n            let res: Uint8Array | null = null;\r\n            let updateView = false;\r\n\r\n            if (modal.type === 'split') {\r\n                if (!mInput1 || !mInput2) return alert(\"Enter pages!\");\r\n                res = await Organize.splitPdf(file, Number(mInput1), Number(mInput2));\r\n            } else if (modal.type === 'delete_page') {\r\n                const pagesToDelete = mInput1.split(',').map(n => parseInt(n.trim()));\r\n                res = await Organize.deletePages(file, pagesToDelete);\r\n                updateView = true;\r\n            } else if (modal.type === 'encrypt') {\r\n                res = await Security.encryptPdf(file, mInput1, settings.permissions);\r\n            } else if (modal.type === 'watermark') {\r\n                res = await Edit.addWatermark(file, mInput1, drawColor);\r\n                updateView = true;\r\n            } else if (modal.type === 'metadata') {\r\n                res = await Security.updateMetadata(file, { title: mInput1, author: mInput2 });\r\n                updateView = true;\r\n            } else if (modal.type === 'html_to_pdf') {\r\n                res = await Convert.htmlToPdf(htmlInput);\r\n                replaceFile(res, 'web_convert.pdf');\r\n                setModal({ type: null, isOpen: false });\r\n                return;\r\n            }\r\n\r\n            if (res) {\r\n                if (updateView) { replaceFile(res); setStatusMsg(\"Applied! \"); }\r\n                else download(res, 'output.pdf');\r\n            }\r\n            setModal({ type: null, isOpen: false });\r\n        } catch (e) { console.error(e); alert('Error: ' + (e as Error).message); }\r\n    };\r\n\r\n    const handleExport = async (fileName: string, options: ExportOptions) => {\r\n        try {\r\n            if (!file) return;\r\n            setIsExportOpen(false);\r\n            setStatusMsg(\"Saving... \");\r\n\r\n            // 1. Convert dirty blocks to whiteout + text annotations\r\n            const blockAnnotations: any[] = [];\r\n            editableBlocks.filter(b => b.isDirty).forEach(block => {\r\n                // Whiteout the original area\r\n                blockAnnotations.push({\r\n                    id: `wo_${block.id}`,\r\n                    page: block.page,\r\n                    type: 'whiteout',\r\n                    x: block.x,\r\n                    y: block.y,\r\n                    width: block.width,\r\n                    height: block.height\r\n                });\r\n                // Add new text on top\r\n                blockAnnotations.push({\r\n                    id: `txt_${block.id}`,\r\n                    page: block.page,\r\n                    type: 'text',\r\n                    x: block.x,\r\n                    y: block.y,\r\n                    text: block.text,\r\n                    size: block.fontSize,\r\n                    fontFamily: block.fontFamily,\r\n                    color: '#000000'\r\n                });\r\n            });\r\n\r\n            // Merge normal annotations + block overrides\r\n            const allAnnotations = [...annotations, ...blockAnnotations];\r\n\r\n            let finalBytes = await Edit.saveAnnotations(file, allAnnotations, pageRotations);\r\n\r\n            if (options.password) {\r\n                const blob = new Blob([Buffer.from(finalBytes)], { type: 'application/pdf' });\r\n                const tempFile = new File([blob], fileName, { type: 'application/pdf' });\r\n                finalBytes = await Security.encryptPdf(tempFile, options.password, settings.permissions);\r\n            }\r\n            download(finalBytes, fileName);\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Export failed: \" + (e as Error).message);\r\n        }\r\n    };\r\n\r\n    const handleFile = async (e: React.ChangeEvent<HTMLInputElement>, type: 'merge' | 'image' | 'word') => {\r\n        const f = e.target.files?.[0];\r\n        if (!f || !file) return;\r\n\r\n        if (type === 'merge') {\r\n            const res = await Organize.mergePdfs(file, f);\r\n            replaceFile(res, 'merged.pdf'); replaceFile(res, 'merged.pdf'); setStatusMsg(\"Merged! \");\r\n        } else if (type === 'word') {\r\n            try {\r\n                setStatusMsg(\"Converting Word... \");\r\n                const pdfBytes = await Convert.convertImageOrOfficeToPdf(f);\r\n                replaceFile(pdfBytes, f.name.replace('.docx', '.pdf')); setStatusMsg(\"Converted! \");\r\n            } catch (e) { alert(\"Conversion Failed\"); }\r\n        } else {\r\n            const reader = new FileReader();\r\n            reader.onload = (ev) => {\r\n                setPendingImage(ev.target?.result as string); setMode('image'); setStatusMsg(\"Tap to place image \");\r\n            };\r\n            reader.readAsDataURL(f);\r\n        }\r\n    };\r\n\r\n    const download = (data: Blob | Uint8Array, name: string) => {\r\n        const blob = data instanceof Blob ? data : new Blob([Buffer.from(data as Uint8Array)]);\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement('a');\r\n        link.href = url; link.download = name;\r\n        document.body.appendChild(link); link.click(); document.body.removeChild(link);\r\n        setStatusMsg(`Saved ${name} `);\r\n        setTimeout(() => setStatusMsg(''), 3000);\r\n    };\r\n\r\n    if (isRestoring) {\r\n        return (\r\n            <div className=\"h-screen w-screen flex flex-col items-center justify-center bg-background text-foreground\">\r\n                <Loader2 className=\"w-10 h-10 animate-spin text-primary mb-4\" />\r\n                <h2 className=\"text-xl font-bold animate-pulse\">Loading Workspace...</h2>\r\n                <p className=\"text-muted-foreground text-sm mt-2\">Restoring your document</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!file) return null;\r\n\r\n    return (\r\n        <div className=\"h-screen w-screen flex flex-col bg-background text-foreground overflow-hidden relative\">\r\n            <input type=\"file\" ref={mergeInputRef} className=\"hidden\" accept=\".pdf\" onChange={e => handleFile(e, 'merge')} />\r\n            <input type=\"file\" ref={imageInputRef} className=\"hidden\" accept=\"image/*\" onChange={e => handleFile(e, 'image')} />\r\n            <input type=\"file\" ref={wordInputRef} className=\"hidden\" accept=\".docx,.pptx,.xlsx\" onChange={e => handleFile(e, 'word')} />\r\n\r\n            {/* AI Processing Overlay */}\r\n            {isAIProcessing && (\r\n                <div className=\"absolute inset-0 z-[200] bg-background/80 backdrop-blur-md flex flex-col items-center justify-center animate-in fade-in duration-300\">\r\n                    <div className=\"relative\">\r\n                        <div className=\"w-24 h-24 border-4 border-primary/20 border-t-primary rounded-full animate-spin\" />\r\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                            <Sparkles className=\"w-8 h-8 text-primary animate-pulse\" />\r\n                        </div>\r\n                    </div>\r\n                    <h3 className=\"mt-8 text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-orange-500 animate-pulse\">\r\n                        Generative AI Processing\r\n                    </h3>\r\n                    <p className=\"text-muted-foreground mt-2\">Scrubbing document and restructuring pixels...</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* 1. HEADER */}\r\n            <div className=\"h-14 bg-white/60 dark:bg-black/60 backdrop-blur-xl border-b border-white/20 flex items-center px-4 justify-between shrink-0 z-40 shadow-sm\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button onClick={() => router.push('/')} className=\"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full transition-colors\"><ChevronLeft className=\"w-5 h-5\" /></button>\r\n                    <div className=\"flex flex-col\">\r\n                        <span className=\"text-sm font-bold truncate max-w-[150px] md:max-w-xs leading-none\">{file.name}</span>\r\n                        <span className=\"text-[10px] text-muted-foreground\">{numPages} Pages</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button onClick={() => setThumbnailsOpen(!isThumbnailsOpen)} className=\"hidden md:block p-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/10\" title=\"Toggle Page Thumbnails\">\r\n                        {isThumbnailsOpen ? <PanelLeftClose className=\"w-5 h-5\" /> : <PanelLeftOpen className=\"w-5 h-5\" />}\r\n                    </button>\r\n                    <button onClick={() => setSidebarOpen(!isSidebarOpen)} className=\"md:hidden p-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/10\">\r\n                        <Menu className=\"w-5 h-5\" />\r\n                    </button>\r\n                    <button onClick={() => setIsSettingsOpen(true)} className=\"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full\"><Settings2 className=\"w-5 h-5\" /></button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 2. MAIN WORKSPACE */}\r\n            <div className=\"flex-1 flex overflow-hidden relative\">\r\n\r\n                {/* Tools Sidebar */}\r\n                <div className={`\r\n                absolute md:static inset-y-0 left-0 z-50\r\n                bg-background/95 backdrop-blur-xl border-r border-border\r\n                transition-transform duration-300 ease-in-out\r\n                ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0 md:w-auto'}\r\n                h-full flex flex-col shadow-2xl md:shadow-none\r\n            `}>\r\n                    <EditorSidebar\r\n                        activeCategory={activeCategory} setActiveCategory={setActiveCategory}\r\n                        activeToolId={mode} onToolSelect={handleToolSelect}\r\n                    />\r\n                </div>\r\n\r\n                {/* Thumbnails Sidebar (Desktop) */}\r\n                <div className={`\r\n                hidden md:block transition-all duration-300 overflow-hidden bg-muted/20 border-r border-border\r\n                ${isThumbnailsOpen ? 'w-32 opacity-100' : 'w-0 opacity-0'}\r\n            `}>\r\n                    <ThumbnailSidebar onPageClick={handlePageClick} currentPageView={activePage} />\r\n                </div>\r\n\r\n                {/* Editor Content */}\r\n                <div className=\"flex-1 flex flex-col min-w-0 bg-muted/20 relative\">\r\n                    <EditorToolbar\r\n                        mode={mode} selectedAnnotationType={selectedAnnotation ? (selectedAnnotation.type as any) : null}\r\n                        zoom={zoom} setZoom={setZoom}\r\n                        onAction={(a) => { if (a === 'merge_add') mergeInputRef.current?.click(); if (a === 'toggle_ai') setIsThinkingOpen(!isThinkingOpen); }}\r\n                        onExport={() => setIsExportOpen(true)}\r\n                        status={statusMsg}\r\n                        drawColor={drawColor} setDrawColor={(c) => { setDrawColor(c); if (mode === 'cursor' && selectedAnnId) updateAnnotation(selectedAnnId, { color: c }); }}\r\n                        brushSize={brushSize} setBrushSize={(s) => { setBrushSize(s); if (mode === 'cursor' && selectedAnnId) updateAnnotation(selectedAnnId, { thickness: s, size: s }); }}\r\n                        textStyle={textStyle} setTextStyle={handleTextStyleChange}\r\n                    />\r\n\r\n                    <div className=\"flex-1 overflow-auto p-4 md:p-8 relative scroll-smooth bg-zinc-100 dark:bg-zinc-900/50\" ref={scrollContainerRef}>\r\n                        <div className=\"min-h-full flex flex-col items-center justify-start pb-20\">\r\n                            {mode === 'image' && pendingImage && (\r\n                                <div className=\"sticky top-4 z-50 bg-primary text-white text-xs px-4 py-2 rounded-full shadow-lg animate-bounce pointer-events-none mb-4\">\r\n                                    Tap on document to drop image \r\n                                </div>\r\n                            )}\r\n                            <PDFCanvas\r\n                                zoom={zoom} setZoom={setZoom} mode={mode}\r\n                                activePage={activePage} onPageSelect={setActivePage}\r\n                                pendingImage={pendingImage} onImagePlaced={() => { setMode('cursor'); setPendingImage(null); }}\r\n                                drawColor={drawColor} brushSize={brushSize} textStyle={textStyle}\r\n                                onStampRemove={handleStampRemove}\r\n                                onAnnotationSelect={handleAnnotationSelect}\r\n                                onCropApply={handleCropApply}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <ThinkingSidebar\r\n                isOpen={isThinkingOpen}\r\n                onClose={() => setIsThinkingOpen(false)}\r\n                messages={chatMessages}\r\n                isThinking={isThinking}\r\n                onSendMessage={handleChatSendMessage}\r\n            />\r\n\r\n            <ReorderDialog isOpen={modal.type === 'reorder'} onClose={() => setModal({ type: null, isOpen: false })} pageCount={numPages} onApply={async (order) => { /*...*/ }} />\r\n            <ExportDialog isOpen={isExportOpen} onClose={() => setIsExportOpen(false)} onExport={handleExport} defaultFileName={file.name.replace('.pdf', '')} />\r\n            <SettingsDialog isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)} />\r\n\r\n            {/* Modals */}\r\n            {modal.isOpen && modal.type !== 'reorder' && (\r\n                <div className=\"fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in\">\r\n                    <div className=\"bg-background rounded-3xl shadow-2xl w-full max-w-sm p-6 animate-in zoom-in-95 border border-border\">\r\n                        {/* Dynamic Modal Content */}\r\n                        <div className=\"mb-4\">\r\n                            <h3 className=\"text-xl font-bold capitalize flex items-center gap-2\">\r\n                                {modal.type === 'watermark' && <Stamp className=\"w-5 h-5 text-primary\" />}\r\n                                {modal.type === 'encrypt' && <Lock className=\"w-5 h-5 text-primary\" />}\r\n                                {modal.type === 'split' && <Scissors className=\"w-5 h-5 text-primary\" />}\r\n                                {modal.type?.replace('_', ' ')}\r\n                            </h3>\r\n                        </div>\r\n\r\n                        {modal.type === 'split' && (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm text-muted-foreground\">Enter the page range to extract (e.g., 1 to 5).</p>\r\n                                <div className=\"flex gap-2\">\r\n                                    <input type=\"number\" placeholder=\"Start\" value={mInput1} onChange={e => setMInput1(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                                    <input type=\"number\" placeholder=\"End\" value={mInput2} onChange={e => setMInput2(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {modal.type === 'delete_page' && (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm text-muted-foreground\">Enter page numbers to delete, separated by commas (e.g., 1, 3, 5).</p>\r\n                                <input type=\"text\" placeholder=\"1, 3, 5\" value={mInput1} onChange={e => setMInput1(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                            </div>\r\n                        )}\r\n\r\n                        {modal.type === 'encrypt' && (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm text-muted-foreground\">Set a password to protect this document.</p>\r\n                                <input type=\"password\" placeholder=\"Password\" value={mInput1} onChange={e => setMInput1(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                            </div>\r\n                        )}\r\n\r\n                        {modal.type === 'watermark' && (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm text-muted-foreground\">Enter text for the watermark stamp.</p>\r\n                                <input type=\"text\" placeholder=\"CONFIDENTIAL\" value={mInput1} onChange={e => setMInput1(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-xs font-medium\">Color:</span>\r\n                                    <input type=\"color\" value={drawColor} onChange={e => setDrawColor(e.target.value)} className=\"h-8 w-16 rounded cursor-pointer\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {modal.type === 'metadata' && (\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-bold text-muted-foreground uppercase\">Title</label>\r\n                                    <input type=\"text\" placeholder=\"Document Title\" value={mInput1} onChange={e => setMInput1(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-bold text-muted-foreground uppercase\">Author</label>\r\n                                    <input type=\"text\" placeholder=\"Author Name\" value={mInput2} onChange={e => setMInput2(e.target.value)} className=\"w-full bg-muted p-2 rounded-lg border border-input\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {modal.type === 'html_to_pdf' && (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm text-muted-foreground\">Paste HTML code to convert to PDF.</p>\r\n                                <textarea\r\n                                    value={htmlInput}\r\n                                    onChange={e => setHtmlInput(e.target.value)}\r\n                                    placeholder=\"<h1>Hello World</h1>\"\r\n                                    className=\"w-full h-32 bg-muted p-2 rounded-lg border border-input font-mono text-xs\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex justify-end gap-2 mt-6\">\r\n                            <button onClick={() => setModal({ type: null, isOpen: false })} className=\"px-4 py-2 rounded-lg hover:bg-muted font-medium text-sm transition-colors\">Cancel</button>\r\n                            <button onClick={handleModalSubmit} className=\"px-6 py-2 bg-primary text-white rounded-lg shadow-lg shadow-primary/20 text-sm font-bold hover:scale-105 transition-transform\">Apply</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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"}}]
}